var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.Category=function(a){for(var b={catId:-1,name:"",isOpen:!1,parentId:-1,subCategories:[],isyLayers:[],isAllLayersSelected:!1},c=$.extend({},b,a),d=[],e=0;e<a.subCategories.length;e++)d.push(new ISY.Domain.Category(a.subCategories[e]));return c.subCategories=d,c};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.FeatureInfo=function(a){var b={supportsGetFeatureInfo:!0,getFeatureInfoFormat:"application/json",getFeatureInfoCrs:"",supportsGetFeature:!0,getFeatureBaseUrl:"",getFeatureFormat:"application/json",getFeatureCrs:"EPSG:4326"},c=$.extend({},b,a);return c};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.FeatureResponse=function(){return{geometryObject:"",crs:"",attributes:[]}};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.Layer=function(a){for(var b={guid:"",subLayers:[],name:"",categoryId:0,visibleOnLoad:!0,isVisible:!1,id:(new ISY.Utils.Guid).NewGuid(),isBaseLayer:!1,previewActive:!1,opacity:1,mapLayerIndex:-1,minResolution:0,maxResolution:1/0,legendGraphicUrls:[],selectedLayerOpen:!1},c=$.extend({},b,a),d=[],e=0;e<a.subLayers.length;e++)d.push(new ISY.Domain.SubLayer(a.subLayers[e]));return c.subLayers=d,c};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.LayerResponse=function(){return{id:-1,isLoading:!1,exception:"",features:[]}};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.LegendGraphic=function(a){function b(){return"?"!==d.url?d.url+"&Request="+d.request+"&Version="+d.version+"&Format="+d.format+"&Width="+d.width+"&Height="+d.height+"&Layer="+d.layer:""}var c={width:"20",height:"20",format:"image/png",request:"GetLegendGraphic",version:"1.0.0",layer:"",url:""},d=$.extend({},c,a);return{GetLegendGraphicUrl:b}};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.MeasureResult=function(a,b,c){function d(){return h}function e(){return i}function f(){return j}function g(){return"Polygon area: "+d()+" Length: "+e()+" Circle area: "+f()}var h=a,i=b,j=c;return{PolygonArea:d,EdgeLength:e,CircleArea:f,GetParsedResult:g}};var ISY=ISY||{};ISY.Domain=ISY.Domain||{},ISY.Domain.SubLayer=function(a){var b=(new ISY.Utils.Guid).NewGuid(),c={name:"",providerName:"",source:ISY.Domain.SubLayer.SOURCES.wmts,url:"",format:ISY.Domain.SubLayer.FORMATS.imagepng,coordinate_system:"",srs_dimension:"",matrixSet:"",extent:[-1,1,-1,1],extentUnits:"m",id:b,transparent:!0,layerIndex:-1,legendGraphicUrl:"",crossOrigin:"anonymous",featureInfoTitle:"",tooltipTemplate:"",showDialog:!0,openNewWindow:!1,openParentWindow:!1,windowWidth:500,featureInfoElement:[],editable:!1,featureInfo:new ISY.Domain.FeatureInfo,featureNS:"",geometryName:"geometry"},d=$.extend({},c,a);if(-1==d.legendGraphicUrl.indexOf("?")&&(d.legendGraphicUrl+="?"),""!==d.legendGraphicUrl){var e=new ISY.Domain.LegendGraphic({url:d.legendGraphicUrl,layer:d.name});d.legendGraphicUrl=e.GetLegendGraphicUrl()}return d},ISY.Domain.SubLayer.SOURCES={wmts:"WMTS",wms:"WMS",vector:"VECTOR",proxyWmts:"proxyWmts",proxyWms:"proxyWms",tms:"TMS",wfs:"WFS"},ISY.Domain.SubLayer.FORMATS={imagepng:"image/png",imagejpeg:"image/jpeg",geoJson:"application/json"};var ISY=ISY||{};ISY.Events=ISY.Events||{},ISY.Events.EventHandler=function(){function a(a,b){d.push({eventType:a,callBack:b})}function b(a,b){for(var c=0;c<d.length;c++)if(d[c].eventType==a&&d[c].callBack==b){d.splice(c,1);break}}function c(a,b){for(var c=0;c<d.length;c++){var e=d[c];e.eventType==a&&e.callBack(b)}}var d=[];return{RegisterEvent:a,UnRegisterEvent:b,TriggerEvent:c}},ISY.Events.EventTypes={ChangeCenter:"ChangeCenter",ChangeResolution:"ChangeResolution",ChangeLayers:"ChangeLayers",FeatureInfoStart:"FeatureInfoStart",FeatureInfoEnd:"FeatureInfoEnd",MapConfigLoaded:"MapConfigLoaded",MapLoaded:"MapLoaded",MapMoveend:"MapMoveend",ShowExportPanel:"ShowExportPanel",MeasureMouseMove:"MeasureMouseMove",LoadingLayerEnd:"LoadingLayerEnd",LayerCreated:"LayerCreated",CachingStart:"CachingStart",CachingEnd:"CachingEnd",CachingProgress:"CachingProgress",StatusPouchDbChanged:"StatusPouchDbChanged",MeasureEnd:"MeasureEnd",DrawFeatureMouseMove:"DrawFeatureMouseMove",DrawFeatureEnd:"DrawFeatureEnd",AddLayerFeatureEnd:"AddLayerFeatureEnd",ModifyFeatureEnd:"ModifyFeatureEnd",RefreshSourceDone:"RefreshSourceDone",ZoomIn:"ZoomIn",ZoomOut:"ZoomOut",TransactionSuccessful:"TransactionSuccessful",TransactionFailed:"TransactionFailed",TransactionInsertEnd:"TransactionInsertEnd",TransactionUpdateEnd:"TransactionUpdateEnd",TransactionRemoveEnd:"TransactionRemoveEnd",FeatureHasBeenDescribed:"FeatureHasBeenDescribed",GeolocationUpdated:"GeolocationUpdated"};var ISY=ISY||{};ISY.Facade=ISY.Facade||{},ISY.Facade.ServerConfigFacade=function(){function a(a,b){$.getJSON(a,function(a){b(a)})}return{GetMapConfig:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Categories=function(){function a(a){d=a.categories}function b(){return d}function c(a){for(var b=0;b<d.length;b++){var c=d[b];if(c.catId.toString()===a.toString())return c;for(var e=0;e<d[b].subCategories.length;e++){var f=d[b].subCategories[e];if(f.catId.toString()===a.toString())return f}}}var d=[];return{Init:a,GetCategoryById:c,GetCategories:b}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.CustomCrsLoader=function(){function a(){proj4.defs("EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3007","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3008","+proj=tmerc +lat_0=0 +lon_0=13.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3009","+proj=tmerc +lat_0=0 +lon_0=15 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3010","+proj=tmerc +lat_0=0 +lon_0=16.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3011","+proj=tmerc +lat_0=0 +lon_0=18 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3012","+proj=tmerc +lat_0=0 +lon_0=14.25 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3013","+proj=tmerc +lat_0=0 +lon_0=15.75 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3014","+proj=tmerc +lat_0=0 +lon_0=17.25 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3015","+proj=tmerc +lat_0=0 +lon_0=18.75 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3016","+proj=tmerc +lat_0=0 +lon_0=20.25 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3017","+proj=tmerc +lat_0=0 +lon_0=21.75 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:3018","+proj=tmerc +lat_0=0 +lon_0=23.25 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:25835","+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),proj4.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:32633","+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:32635","+proj=utm +zone=35 +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:3575","+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"),proj4.defs("EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ")}return{LoadCustomCrs:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Map=ISY.MapAPI.Map||{},ISY.MapAPI.FeatureInfo=function(a,b,c,d){function e(a){var b=f(a);c.TriggerEvent(ISY.Events.EventTypes.FeatureInfoStart,b)}function f(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=new ISY.Domain.LayerResponse;e.id=d.id,e.name=d.providerName,e.isLoading=!0,b.push(e)}return b}function g(a,c){var d=function(a){h(c,a)};b.get(a).success(d)}function h(a,b){var e,f;try{e=d.Parse(b)}catch(g){f=g}var h=new ISY.Domain.LayerResponse;h.id=a.id,h.name=a.providerName,h.isLoading=!1,h.features=e,h.exception=f,h.featureInfoTitle=a.featureInfoTitle,(a.source===ISY.Domain.SubLayer.SOURCES.proxyWms||a.source==ISY.Domain.SubLayer.SOURCES.proxyWmts||a.source===ISY.Domain.SubLayer.SOURCES.wms||a.source===ISY.Domain.SubLayer.SOURCES.wmts)&&(h.wms=!0),h.featureInfoElement=a.featureInfoElement,h.showDialog=a.showDialog,h.openNewWindow=a.openNewWindow,h.openParentWindow=a.openParentWindow,h.windowWidth=a.windowWidth,h.editable=a.editable,c.TriggerEvent(ISY.Events.EventTypes.FeatureInfoEnd,h)}function i(a,c,d){var e,f=function(a){var b=j(a);d(b)},g=a.url.replace("proxy/wms","proxy/"),h="?",i=g.indexOf(h)>-1;i||(g+=encodeURIComponent(h));var k="SERVICE="+c+"&REQUEST=GETCAPABILITIES";(a.source===ISY.Domain.SubLayer.SOURCES.proxyWms||a.source==ISY.Domain.SubLayer.SOURCES.proxyWmts)&&(k=encodeURIComponent(k)),e=g+k,b.get(e).success(f)}function j(a){var b=new ol.format.WMSCapabilities,c=b.read(a);return c}function k(b,c){B===!0&&s(b),e(c);for(var d=0;d<c.length;d++){var f=c[d];switch(f.source){case ISY.Domain.SubLayer.SOURCES.wmts:case ISY.Domain.SubLayer.SOURCES.wms:case ISY.Domain.SubLayer.SOURCES.proxyWms:case ISY.Domain.SubLayer.SOURCES.proxyWmts:l(f,b);break;case ISY.Domain.SubLayer.SOURCES.wfs:case ISY.Domain.SubLayer.SOURCES.vector:var g=a.GetFeaturesInExtent(f,a.GetExtentForCoordinate(b,C));h(f,g)}}}function l(b,c){var d=a.GetInfoUrl(b,c);g(d,b)}function m(a,b){var c="WMS",d=function(a){var c=a.Capability.Request.GetFeatureInfo.Format;b(c)};i(a,c,d)}function n(b,c){e(c);for(var d=0;d<c.length;d++){var f=c[d];switch(f.source){case ISY.Domain.SubLayer.SOURCES.wmts:case ISY.Domain.SubLayer.SOURCES.wms:case ISY.Domain.SubLayer.SOURCES.proxyWms:case ISY.Domain.SubLayer.SOURCES.proxyWmts:o(f,b);break;case ISY.Domain.SubLayer.SOURCES.wfs:case ISY.Domain.SubLayer.SOURCES.vector:var g=a.GetFeaturesInExtent(f,b);h(f,g)}}}function o(b,c){var d=a.GetProxyHost(),e=d+p(b,c);g(e,b)}function p(a,b){var c=a.featureInfo.getFeatureCrs,d=b,e="service=WMS&version=1.3.0&request=GetFeatureInfo&TRANSPARENT="+a.transparent+"&QUERY_LAYERS="+a.name+"&INFO_FORMAT="+a.featureInfo.getFeatureInfoFormat+"&SRS="+c+"&bbox="+d+"&width=400&height=400&x=150&y=150";return e=decodeURIComponent(e),e=e.substring(e.lastIndexOf("?"),e.length),e=e.replace("?",""),e=encodeURIComponent(e),a.url[0].replace("proxy/wms","proxy/")+e}function q(a,b){var c="WFS",d=function(a){var c=a.Capability.Request.GetFeature.Format;b(c)};i(a,c,d)}function r(){z=document.createElement("img"),z.src=A,w(),u()}function s(b){void 0===z&&r(),t(z,!0),z.style.visibility="visible",a.ShowInfoMarker(b,z)}function t(b,c){B===!0&&(c===!0&&(void 0===z&&r(),a.RemoveInfoMarker(z),w(),B=!1),z=b)}function u(){document.body.appendChild(z)}function v(){B=!0,t(z,!0)}function w(){z.style.visibility="hidden"}function x(a){A=a}function y(a){s(a)}var z,A="assets/img/pin-md-orange.png",B=!1,C=10;return{HandlePointSelect:k,HandleBoxSelect:n,CreateDefaultInfoMarker:r,SetInfoMarker:t,RemoveInfoMarker:v,GetSupportedGetFeatureInfoFormats:m,GetSupportedGetFeatureFormats:q,SetInfoMarkerPath:x,ShowInfoMarker:y}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Groups=function(){function a(a){d=a.groups}function b(){return d}function c(a){for(var b=0;b<d.length;b++){var c=d[b];if(c.groupId.toString()===a.toString())return c;for(var e=0;e<d[b].subCategories.length;e++){var f=d[b].subCategories[e];if(f.groupId.toString()===a.toString())return f}}}var d=[];return{Init:a,GetGroupById:c,GetGroups:b}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Layers=function(a){function b(a){y=a,z=a.layers,c();for(var b=g(),d=!1,e=0;e<b.length;e++){var f=b[e];f.visibleOnLoad?i(f):d===!1&&(f.visibleOnLoad=!0,i(f),d=!0)}for(var j=h(),k=0;k<j.length;k++){var n=j[k];n.visibleOnLoad?l(n):m(n)}}function c(){for(var a=0,b=g(),c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.subLayers.length;e++)d.subLayers[e].layerIndex=a,a++;for(var f=h(),i=0;i<f.length;i++)for(var j=f[i],k=0;k<j.subLayers.length;k++)j.subLayers[k].layerIndex=a,a++}function d(){return void 0!==y?y.layers:[]}function e(a,b){return a.id<b.id?-1:a.id>b.id?1:0}function f(){if(!A){A=!0;for(var a=h(),b=[],c=0;c<a.length;c++){var d=a[c];d.isVisible&&b.push(d)}b.sort(e),b.forEach(function(a){l(a)})}}function g(){return d().filter(function(a){return a.isBaseLayer===!0})}function h(){return d().filter(function(a){return a.isBaseLayer===!1})}function i(a){for(var b=o(),c=0;c<b.length;c++){var d=b[c];m(d)}t(a)}function j(){for(var a=1,b=0;b<y.groups.length&&void 0!==y.groups[b].isyLayers;b++)for(var c=0;c<y.groups[b].isyLayers.length;c++)for(var d=0;d<y.groups[b].isyLayers[c].subLayers.length;d++)y.groups[b].isyLayers[c].subLayers[d].sortingIndex=a,a+=1}function k(a){l(a),z.push(a)}function l(b){for(var c=b.subLayers,d=0;d<c.length;d++){var e=c[d];w(e)?a.ShowLayer(e):a.HideLayer(e)}b.isVisible=!0,j(),a.UpdateLayerSortIndex(y.groups),a.SortLayerBySortIndex(),a.RedrawMap()}function m(b){var c=b.subLayers;b.isVisible=!1;for(var d=0;d<c.length;d++){var e=c[d];a.HideLayer(e)}b.mapLayerIndex=-1}function n(){for(var a=[],b=v(),c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.subLayers.length;e++){var f=d.subLayers[e];w(f)&&a.push(f)}return a}function o(){return g().filter(function(a){return a.isVisible===!0})}function p(a){if(void 0!==c)for(var b=0;b<z.length;b++){var c=z[b];if(c.id.toString()===a.toString())return c}}function q(){j(),a.UpdateLayerSortIndex(y.groups),a.SortLayerBySortIndex(),a.RedrawMap()}function r(b,c){for(var d=b.subLayers,e=0;e<d.length;e++){var f=d[e];w(f)&&a.MoveLayerToIndex(f,c)}a.RedrawMap()}function s(b,c){for(var d=x(c),e=b.subLayers,f=0;f<e.length;f++){var g=e[f];w(g)&&a.MoveLayerToIndex(g,d)}}function t(b){for(var c=b.subLayers,d=0;d<c.length;d++){var e=c[d];w(e)?a.ShowBaseLayer(e):a.HideLayer(e)}b.isVisible=!0,u()}function u(){for(var a=v(),b=0;b<a.length;b++){var c=a[b];c.mapLayerIndex=x(c)}}function v(){return h().filter(function(a){return a.isVisible===!0})}function w(){return!0}function x(b){for(var c=b.subLayers,d=[],e=0;e<c.length;e++){var f=c[e],g=a.GetLayerIndex(f);null!=g&&d.push(g)}return Math.max(d)}var y,z,A;return{Init:b,ArrangeLayers:f,GetBaseLayers:g,GetOverlayLayers:h,SetBaseLayer:i,AddLayer:k,HideLayer:m,ShowLayer:l,GetVisibleSubLayers:n,GetVisibleBaseLayers:o,GetLayerById:p,MoveLayerToIndex:r,MoveLayerToIndexInGroup:q,MoveLayerAbove:s,ShouldBeVisible:w}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Map=function(a,b,c,d,e,f){function g(c,g){h(),ub=g,a.InitMap(c,g),d.Init(g),e.Init(g),f.Init(g),b.TriggerEvent(ISY.Events.EventTypes.MapLoaded)}function h(){var a=new ISY.MapAPI.CustomCrsLoader;a.LoadCustomCrs(),i("EPSG:25832"),i("EPSG:25833"),i("EPSG:25835"),i("EPSG:32632"),i("EPSG:32633"),i("EPSG:32635")}function i(a){if("undefined"!=typeof ol){var b=new ol.proj.Projection({code:a,units:"m"});ol.proj.addProjection(b)}}function j(b){a.ChangeView(b)}function k(){a.RedrawMap()}function l(){a.RefreshMap()}function m(b,c){a.RefreshLayerByGuid(b,c)}function n(a){d.AddLayer(a)}function o(b,c){a.AddDataToLayer(b.subLayers[0],c)}function p(b,c){a.RemoveDataFromLayer(b.subLayers[0],c)}function q(b){a.ClearLayer(b.subLayers[0])}function r(a){d.ShowLayer(a)}function s(a){d.HideLayer(a)}function t(b,c){for(var d=b.subLayers,e=0;e<d.length;e++){var f=d[e];a.SetLayerOpacity(f,c)}a.RedrawMap()}function u(a){d.SetBaseLayer(a)}function v(){return d.GetBaseLayers()}function w(){return d.GetVisibleBaseLayers()[0]}function x(){return d.GetOverlayLayers()}function y(){return d.GetVisibleSubLayers()}function z(a){return d.GetLayerById(a)}function A(a,b){d.MoveLayerToIndex(a,b)}function B(){d.MoveLayerToIndexInGroup()}function C(a,b){d.MoveLayerAbove(a,b)}function D(a){return d.ShouldBeVisible(a)}function E(a){return f.GetCategoryById(a)}function F(){return f.GetCategories()}function G(a){return e.GetGroupById(a)}function H(){return e.GetGroups()}function I(b){a.ExportMap(b)}function J(b){a.ActivateExport(b)}function K(){a.DeactivateExport()}function L(){return a.RenderSync()}function M(a){c.SetInfoMarkerPath(a),c.CreateDefaultInfoMarker()}function N(a,b){c.SetInfoMarker(a,b)}function O(){c.RemoveInfoMarker()}function P(b,c){a.ShowHighlightedFeatures(b,c)}function Q(){a.ClearHighlightedFeatures()}function R(b){a.SetHighlightStyle(b)}function S(){a.ActivateInfoClick(ga)}function T(a){c.ShowInfoMarker(a)}function U(){a.DeactivateInfoClick()}function V(){a.ActivateBoxSelect(ia)}function W(){a.DeactivateBoxSelect()}function X(b){return a.InitEdit(b)}function Y(b,c){a.DescribeFeature(b,c)}function Z(){a.ActivateEditSelect(ka)}function $(){a.DeactivateEditSelect()}function _(b){a.UpdateFeature(b)}function aa(b,c){return a.InsertFeature(b,c)}function ba(b){return a.DeleteFeature(b)}function ca(a,b){c.GetSupportedGetFeatureInfoFormats(a,b)}function da(a,b){c.GetSupportedGetFeatureFormats(a,b)}function ea(){ab()==bb()&&d.ArrangeLayers()}function fa(b){return a.ConvertGmlToGeoJson(b)}function ga(a){c.HandlePointSelect(a,ha())}function ha(){var a=y();return a.filter(function(a){return a.featureInfo?a.featureInfo.supportsGetFeatureInfo===!0:!1})}function ia(a){c.HandleBoxSelect(a,ja())}function ja(){var a=y();return a.filter(function(a){return a.featureInfo.supportsGetFeature===!0})}function ka(b){a.HandlePointSelect(b)}function la(b){a.ActivateMeasure(b)}function ma(){a.DeactivateMeasure()}function na(b){a.ActivateMeasureLine(b)}function oa(){a.DeactivateMeasureLine()}function pa(b){a.ActivateAddLayerFeature(b)}function qa(){a.DeactivateAddLayerFeature()}function ra(b){a.ActivateAddFeatureGps(b)}function sa(b){a.AddCoordinatesGps(b)}function ta(){a.DeactivateAddFeatureGps()}function ua(b){a.ActivateModifyFeature(b)}function va(){a.DeactivateModifyFeature()}function wa(b){a.ActivateDrawFeature(b)}function xa(b){a.DeactivateDrawFeature(b)}function ya(){a.InitOffline()}function za(){a.ActivateOffline()}function Aa(b,c,d){a.StartCaching(b,c,d)}function Ba(){a.StopCaching()}function Ca(b,c,d){a.DeleteDatabase(b,c,d)}function Da(){return a.CacheDatabaseExist()}function Ea(b,c,d){return a.CalculateTileCount(b,c,d)}function Fa(b,c,d){a.GetResource(b,c,d)}function Ga(b,c,d){a.GetConfigResource(b,c,d)}function Ha(b,c,d){a.GetResourceFromJson(b,c,d)}function Ia(b,c,d){a.GetLayerResource(b,c,d)}function Ja(){a.DeactivateOffline()}function Ka(){a.ActivateHoverInfo()}function La(){a.DeactivateHoverInfo()}function Ma(b,c){a.ExtentToGeoJson(b,c)}function Na(b){if(a.ChangeView(b),b.layers){var c=b.layers,d=c.split(",");d.forEach(function(a){var b=z(a);b&&(b.isBaseLayer===!0?u(b):r(b))})}}function Oa(a){a.legendGraphicUrls=[];for(var b=0;b<a.subLayers.length;b++){var c=a.subLayers[b];a.isVisible&&D(c)&&a.legendGraphicUrls.push(c.legendGraphicUrl)}}function Pa(){a.AddZoom()}function Qa(){a.AddZoomSlider()}function Ra(b){a.AddZoomToExtent(b)}function Sa(b){a.ZoomToLayer(b)}function Ta(b){a.FitExtent(b)}function Ua(){return a.GetCenter()}function Va(b){return a.SetCenter(b)}function Wa(){return a.GetZoom()}function Xa(b){a.SetZoom(b)}function Ya(){return a.GetRotation()}function Za(b,c){a.SetRotation(b,c)}function $a(){return a.GetEpsgCode()}function _a(b,c){return a.GetVectorLayers(b,c)}function ab(){if(ub){var a=0;return ub.layers.forEach(function(b){b.isVisible&&b.subLayers.forEach(function(){a++})}),a}}function bb(){return a.GetLayerCount()}function cb(b){return a.GetCenterFromExtent(b)}function db(){return a.GetScale()}function eb(b){return a.GetFeatureCollection(b)}function fb(b){return a.GetFeaturesInMap(b)}function gb(b){return a.GetFeatureExtent(b)}function hb(b){return a.GetLegendStyles(b)}function ib(){return a.GetExtent()}function jb(){return a.GetUrlObject()}function kb(){return a.GetGeolocation()}function lb(){return a.RemoveGeolocation()}function mb(a){ga(a)}function nb(b){a.SetTranslateOptions(b)}function ob(b,c,d){return a.TransformCoordinates(b,c,d)}function pb(b){return a.TransformFromGeographic(b)}function qb(b){return a.TransformToGeographic(b)}function rb(){a.RemoveIsyToken()}function sb(b){a.SetIsyToken(b)}function tb(b){a.ShowCustomMessage(b)}var ub;return{Init:g,AddLayer:n,AddDataToLayer:o,RemoveDataFromLayer:p,ClearLayer:q,ShowLayer:r,HideLayer:s,GetOverlayLayers:x,GetBaseLayers:v,GetLayerById:z,GetFirstVisibleBaseLayer:w,SetBaseLayer:u,SetStateFromUrlParams:Na,SetLayerOpacity:t,MoveLayerToIndex:A,MoveLayerAbove:C,MoveLayerToIndexInGroup:B,GetCategoryById:E,GetCategories:F,GetGroupById:G,GetGroups:H,RenderSync:L,ExportMap:I,ActivateExport:J,DeactivateExport:K,ActivateInfoClick:S,DeactivateInfoClick:U,ShowHighlightedFeatures:P,ClearHighlightedFeatures:Q,SetHighlightStyle:R,SetInfoMarker:N,SetImageInfoMarker:M,GetSupportedGetFeatureInfoFormats:ca,GetSupportedGetFeatureFormats:da,RemoveInfoMarker:O,ActivateBoxSelect:V,DeactivateBoxSelect:W,GetFeatureCollection:eb,GetFeaturesInMap:fb,GetFeatureExtent:gb,InitEdit:X,ActivateEditClick:Z,DeactivateEditClick:$,UpdateFeature:_,InsertFeature:aa,DeleteFeature:ba,ActivateHoverInfo:Ka,DeactivateHoverInfo:La,ActivateMeasure:la,DeactivateMeasure:ma,InitOffline:ya,ActivateOffline:za,StartCaching:Aa,StopCaching:Ba,DeleteDatabase:Ca,CacheDatabaseExist:Da,CalculateTileCount:Ea,GetResource:Fa,GetConfigResource:Ga,GetLayerResource:Ia,DeactivateOffline:Ja,GetResourceFromJson:Ha,ActivateMeasureLine:na,DeactivateMeasureLine:oa,ActivateAddLayerFeature:pa,DeactivateAddLayerFeature:qa,ActivateAddFeatureGps:ra,AddCoordinatesGps:sa,DeactivateAddFeatureGps:ta,ActivateModifyFeature:ua,DeactivateModifyFeature:va,ActivateDrawFeature:wa,DeactivateDrawFeature:xa,ArrangeLayers:ea,ConvertGmlToGeoJson:fa,SetLegendGraphics:Oa,ExtentToGeoJson:Ma,AddZoom:Pa,AddZoomSlider:Qa,AddZoomToExtent:Ra,ZoomToLayer:Sa,FitExtent:Ta,GetCenter:Ua,SetCenter:Va,GetZoom:Wa,SetZoom:Xa,GetRotation:Ya,SetRotation:Za,GetEpsgCode:$a,GetVectorLayers:_a,GetCenterFromExtent:cb,GetScale:db,ChangeView:j,GetLegendStyles:hb,RedrawMap:k,RefreshMap:l,RefreshLayerByGuid:m,ShowInfoMarker:T,GetExtent:ib,GetVisibleSubLayers:y,GetUrlObject:jb,GetGeolocation:kb,RemoveGeolocation:lb,InfoClickSimulation:mb,SetTranslateOptions:nb,TransformCoordinates:ob,TransformFromGeographic:pb,TransformToGeographic:qb,DescribeFeature:Y,RemoveIsyToken:rb,SetIsyToken:sb,ShowCustomMessage:tb}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.Base=function(a){function b(b){var e,f="exception",g="<?xml",h="<html",i="msgmloutput";if(void 0===b)return null;if(b.type)"FeatureCollection"==b.type&&(e="geoJson");else if(void 0!==b.length)b.length>=1&&(e="geoJson");else{if(b.toLowerCase().indexOf(f)>-1)return c(b);if(b.toLowerCase().indexOf(g)>-1)e="kartKlifNo";else{if(b.toLowerCase().indexOf(h)>-1)return d(b);if(!(b.toLowerCase().indexOf(i)>-1))return null;e="fisheryDirectory"}}var j=a.CreateParser(e);return j.Parse(b)}function c(a){var b=new ISY.MapAPI.Parsers.Exception;b.Parse(a)}function d(a){var b=a.indexOf("<table");if(b>-1){var c=a.substring(b,a.length),d=c.indexOf("</body>");c=c.substring(0,d),console.log(c);var e=xml2json.parser(c);console.log(e)}return[]}return{Parse:b}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.Exception=function(){function a(a){var b=a.replace(/(<([^>]+)>)/gi,"");throw b}return{Parse:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.Factory=function(a,b,c,d){function e(e){var f;switch(e){case"geoJson":f=a;break;case"gml":f=b;break;case"kartKlifNo":f=c;break;case"fisheryDirectory":f=d}return f}return{CreateParser:e}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.FiskeriDir=function(a){function b(a){var b=[];a=a.replace(/:gml/g,""),a=a.replace(/gml:/g,h),a=a.replace(/s:x/g,"sx");var d=xml2json.parser(a),e=d[Object.keys(d)[0]];for(var f in e){var g=e[f];if(g instanceof Object)for(var i in g){var j=g[i];j instanceof Array&&(b=c(j))}}return b}function c(b){for(var c=[],i=0;i<b.length;i++){var j=b[i],k=new ISY.Domain.FeatureResponse;k.attributes=d(j);var l=g[Object.keys(g)[0]].srsname,m=g[Object.keys(g)[0]][h+"coordinates"];m=m.replace(/ /g,","),k.crs=l,k.geometryObject=a.ExtentToGeoJson(e,f),c.push(k)}return c}function d(a){var b=[];for(var c in a)-1===c.toLocaleLowerCase().indexOf(h)?(b.push([c,a[c]]),"x"==c&&(e=a[c]),"y"==c&&(f=a[c])):g=a[c];return b}var e,f,g,h="insteadofgml";return{Parse:b}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.GML=function(){function a(a){console.log(a)}return{Parse:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.GeoJSON=function(){function a(a){var c,d=[];if(a.crs){var e=a.crs;e.properties.code?c=e.type+":"+e.properties.code:e.properties.name&&(c=e.properties.name.substring(e.properties.name.indexOf("EPSG"),e.properties.name.length))}if(void 0!==a.features)for(var f=a.features,g=0;g<f.length;g++){var h=f[g],i=new ISY.Domain.FeatureResponse;i.crs=c,i.geometryObject=h,i.attributes=b(h.properties),i.olFeature=h.olFeature,d.push(i)}else if(void 0!==a.length)for(var j=0;j<a.length;j++)if(void 0!==a[j].rows.length){var k=new ISY.Domain.FeatureResponse;k.crs="",k.geometryObject="",k.attributes=b(a[j].rows[0]),d.push(k)}return d}function b(a){var b=[];for(var c in a)b.push([c,a[c]]);return b}return{Parse:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Parsers=ISY.MapAPI.Parsers||{},ISY.MapAPI.Parsers.KartKlifNo=function(){function a(a){var c=[];a=a.replace(/:/g,"");var d=xml2json.parser(a);if(d.featureinforesponse){var e=d.featureinforesponse;if(e.fields){var f=e.fields;if(f instanceof Array)for(var g=0;g<f.length;g++)c.push(f[g]);else c.push(f)}}return b(c)}function b(a){for(var b=[],d=0;d<a.length;d++){var e=new ISY.Domain.FeatureResponse;e.attributes=c(a[d]),b.push(e)}return b}function c(a){var b=[];for(var c in a)b.push([c,a[c]]);return b}return{Parse:a}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Tools=ISY.MapAPI.Tools||{},ISY.MapAPI.Tools.Tool=function(a){var b={id:"",activate:function(){console.log("Not implemented")},deactivate:function(){console.log("Not implemented")},messageObject:[],description:"",isCommand:!1},c=$.extend({},b,a);return c.Extend=function(a){return c=$.extend(c,a)},c};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Tools=ISY.MapAPI.Tools||{},ISY.MapAPI.Tools.ToolFactory=function(a,b){function c(a){k.push(a)}function d(){for(var a=[],b=0;b<k.length;b++)a.push(k[b].id);return a}function e(a){for(var b=!1,c=0;c<k.length;c++){var d=k[c];d.deactivate(),d.id==a&&($.isEmptyObject(m)?d.activate():d.activate(m),b=d.isCommand)}return b}function f(a){for(var b=0;b<a.length;b++){var c=a[b],d=g(c.id);d&&k.push(d)}}function g(a){for(var b=0;b<j.length;b++){var c=j[b];if(c.id===a)return c}return!1}function h(a){var b=g(a);b&&(m={},b.deactivate(l))}function i(a){m=a}var j=[],k=[],l=a,m={};return j=b.GetTools(),{AddTool:c,GetAvailableTools:d,ActivateTool:e,SetupTools:f,DeactivateTool:h,AdditionalToolOptions:i}};var ISY=ISY||{};ISY.MapAPI=ISY.MapAPI||{},ISY.MapAPI.Tools=ISY.MapAPI.Tools||{},ISY.MapAPI.Tools.Tools=function(a){function b(){return c}var c=[],d={id:"PointSelect",description:"This tool activates a get feature info click on the map",activate:function(){a.ActivateInfoClick()},deactivate:function(){a.DeactivateInfoClick()},messageObject:[]},e=new ISY.MapAPI.Tools.Tool(d);c.push(e);var f={id:"DefaultZoom",description:"This is the default tool",activate:function(){},deactivate:function(){},messageObject:[]},g=new ISY.MapAPI.Tools.Tool(f);c.push(g);var h={id:"BoxSelect",description:"This tool activates box select functionality to the map",activate:function(){a.ActivateBoxSelect()},deactivate:function(){a.DeactivateBoxSelect()},messageObject:[]},i=new ISY.MapAPI.Tools.Tool(h);c.push(i);var j={id:"DrawFeature",description:"This tool lets the user draw a feature in the map",activate:function(b){a.ActivateDrawFeature(b)},deactivate:function(){a.DeactivateDrawFeature()},messageObject:[]},k=new ISY.MapAPI.Tools.Tool(j);c.push(k);var l={id:"ModifyFeature",description:"This tool lets the user modify feature in the map.",activate:function(b){a.ActivateModifyFeature(b)},deactivate:function(){a.DeactivateModifyFeature()},messageObject:[]},m=new ISY.MapAPI.Tools.Tool(l);c.push(m);var n={id:"AddLayerFeature",description:"This tool lets the user add feature to the map",activate:function(b){a.ActivateAddLayerFeature(b)},deactivate:function(){a.DeactivateAddLayerFeature()},messageObject:[]},o=new ISY.MapAPI.Tools.Tool(n);c.push(o);var p={id:"AddFeatureGps",description:"This tool lets the user add feature to the map with geolocation",activate:function(b){a.ActivateAddFeatureGps(b)},deactivate:function(){a.DeactivateAddFeatureGps()},messageObject:[]},q=new ISY.MapAPI.Tools.Tool(p);c.push(q);var r={id:"Measure",description:"This tool lets the user measure in the map",activate:function(b){a.ActivateMeasure(b)},deactivate:function(){a.DeactivateMeasure()},messageObject:[]},s=new ISY.MapAPI.Tools.Tool(r);c.push(s);var t={id:"MeasureLine",description:"This tool lets the user measure line in the map",activate:function(b){a.ActivateMeasureLine(b)},deactivate:function(){a.DeactivateMeasureLine()},messageObject:[]},u=new ISY.MapAPI.Tools.Tool(t);c.push(u);var v={id:"FeatureHoverInfo",description:"This tool allow user get info via mouse hover",activate:function(){a.ActivateHoverInfo()},deactivate:function(){a.DeactivateHoverInfo()},messageObject:[]},w=new ISY.MapAPI.Tools.Tool(v);c.push(w);var x={id:"FeatureEditor",description:"This tool allow user to edit features",activate:function(){a.ActivateEditClick()},deactivate:function(){a.DeactivateEditClick()},messageObject:[]},y=new ISY.MapAPI.Tools.Tool(x);return c.push(y),{GetTools:b}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.Leaflet=ISY.MapImplementation.Leaflet||{},ISY.MapImplementation.Leaflet.Map=function(a,b,c,d,e,f){function g(a,b){W=b.proxyHost;var c=[];c[0]=b.newMaxRes;for(var d=1;d<b.numZoomLevels;d++)c[d]=c[d-1]/2;var e=b.layers[0].subLayers[0],f=L.CRS.EPSG900913,g=null;switch(e.source){case"TMS":g=new ISY.MapImplementation.Leaflet.Sources.Tms(e);break;case"WMS":g=new ISY.MapImplementation.Leaflet.Sources.Wms(e)}U=new L.Map(a,{layers:[g],center:new L.LatLng(63.4,255250),crs:f,zoom:3,reuseTiles:!0,continuousWorld:!0,worldCopyJump:!1,scale:function(a){return 1/(b.newMaxRes/Math.pow(2,a))},resolutions:c}),L.control.scale({imperial:!1}).addTo(U),L.control.mousePosition().addTo(U),h()}function h(){var a=function(){var a=Y();b.TriggerEvent(ISY.Events.EventTypes.MapMoveend,a)};U.on("moveend",a)}function i(a){var b,c,d,e=U.getView();if(a.lon&&(b=a.lon),a.lat&&(c=a.lat),a.zoom&&(d=a.zoom),void 0!==b&&void 0!==c){var f=parseFloat(c.replace(/,/g,".")),g=parseFloat(b.replace(/,/g,"."));isFinite(f)&&isFinite(g)&&e.setCenter([g,f])}void 0!==d&&e.setZoom(d)}function j(a){var b=m(a);U.addLayer(b),u()}function k(a){console&&console.log(a.name),u()}function l(a){return console&&console.log(a.name),null}function m(a){var b,c,d=o(a);if(null!=d)b=d;else{switch(a.source){case ISY.Domain.SubLayer.SOURCES.wmts:c=new ISY.MapImplementation.Leaflet.Sources.Wmts(a);break;case ISY.Domain.SubLayer.SOURCES.proxyWmts:a.url=W+a.url,c=new ISY.MapImplementation.Leaflet.Sources.Wmts(a);break;case ISY.Domain.SubLayer.SOURCES.wms:c=new ISY.MapImplementation.Leaflet.Sources.Wms(a);break;case ISY.Domain.SubLayer.SOURCES.tms:c=new ISY.MapImplementation.Leaflet.Sources.Tms(a);break;case ISY.Domain.SubLayer.SOURCES.proxyWms:a.url=W+a.url,c=new ISY.MapImplementation.Leaflet.Sources.Wms(a);break;case ISY.Domain.SubLayer.SOURCES.vector:c=new ISY.MapImplementation.Leaflet.Sources.Vector(a,U.getView().getProjection()),
n(a,c);break;default:throw"Unsupported source: ISY.Domain.SubLayer.SOURCES.'"+a.source+"'. For SubLayer with url "+a.url+" and name "+a.name+"."}b=a.source===ISY.Domain.SubLayer.SOURCES.vector?new ol.layer.Vector({source:c}):a.tiled?c:c,b.layerIndex=a.layerIndex,b.guid=a.id,V.push(b)}return b}function n(a,b){var d=function(c){for(var d=ol.proj.get(a.coordinate_system),e=ol.proj.get(b.getProjection().getCode()),f=b.parser.readFeatures(c),g=0;g<f.length;g++){var h=f[g];h.getGeometry().transform(d,e)}b.addFeatures(f)};c.get(a.url).success(d)}function o(a){for(var b=0;b<V.length;b++){var c=V[b];if(c.guid==a.id)return c}return null}function p(a,b){var c=_getLayerByGuid(a.id);c&&!isNaN(b)&&c.setBrightness(Math.min(b,1))}function q(a,b){var c=_getLayerByGuid(a.id);c&&!isNaN(b)&&c.setContrast(Math.min(b,1))}function r(a,b){var c=_getLayerByGuid(a.id);c&&!isNaN(b)&&c.setOpacity(Math.min(b,1))}function s(a,b){var c=_getLayerByGuid(a.id);c&&!isNaN(b)&&c.setSaturation(Math.min(b,1))}function t(a,b){var c=_getLayerByGuid(a.id);c&&!isNaN(b)&&c.setHue(Math.min(b,1))}function u(){var a=Y();b.TriggerEvent(ISY.Events.EventTypes.ChangeLayers,a)}function v(a){f.Activate(a,U,y),window.addEventListener("resize",X,!1)}function w(){window.removeEventListener("resize",X,!1),f.Deactivate(y)}function x(a){f.ExportMap(a,U)}function y(){U.updateSize()}function z(){U.renderSync()}function A(a){e.ActivateInfoClick(a,U)}function B(){e.DeactivateInfoClick(U)}function C(a,b){return e.GetFeatureInfoUrl(a,o(a),b,U.getView())}function D(a,b){e.ShowHighlightedFeatures(a,b,U)}function E(){e.ClearHighlightedFeatures()}function F(a,b){e.ShowInfoMarker(a,b,U)}function G(a){e.RemoveInfoMarker(a,U)}function H(a){e.SetHighlightStyle(a)}function I(a){e.ActivateBoxSelect(a,U)}function J(){e.DeactivateBoxSelect(U)}function K(a,b){return e.GetExtentForCoordinate(a,b,U.getView().getResolution())}function M(a,b){return e.GetFeaturesInExtent(b,o(a),U.getView().getResolution())}function N(a){d.Activate(U,a)}function O(){d.Deactivate(U)}function P(a,b,c){var d=c;if(""!==a&&""!==b){var e=ol.proj.get(a),f=ol.proj.get(b),g=ol.proj.transformExtent(c,e,f);d=g,"EPSG:4326"===b&&(d=g[1]+","+g[0]+","+g[3]+","+g[2])}return d}function Q(a){var b=new ol.format.WMSCapabilities,c=b.read(a),d=new ol.format.GML,e=d.readFeatures(c),f=new ol.format.GeoJSON;return f.writeFeatures(e)}function R(a,b){var c=new ol.geom.Point([a,b]),d=new ol.Feature;d.setGeometry(c);var e=new ol.format.GeoJSON;return e.writeFeature(d)}function S(){var a=new ol.control.Zoom;U.addControl(a)}function T(){var a=new ol.control.ZoomSlider;U.addControl(a)}var U,V=[],W="",X=function(){f.WindowResized(U)},Y=function(){var a=U.getCenter(),b={lon:a.lng,lat:a.lat,z:U.getZoom()};return b},Z=function(){var a=U.getCenter(),b=U.getZoom(),c={lon:a.lng,lat:a.lat,zoom:b};return c};return{InitMap:g,ChangeView:i,ShowLayer:j,ShowBaseLayer:k,HideLayer:l,GetLayerByName:void 0,SetLayerOpacity:r,SetLayerSaturation:s,SetLayerHue:t,SetLayerBrightness:p,SetLayerContrast:q,MoveLayerToIndex:void 0,GetLayerIndex:void 0,RedrawMap:y,RenderSync:z,ExportMap:x,ActivateExport:v,DeactivateExport:w,ActivateInfoClick:A,DeactivateInfoClick:B,GetInfoUrl:C,ShowHighlightedFeatures:D,ClearHighlightedFeatures:E,ShowInfoMarker:F,SetHighlightStyle:H,RemoveInfoMarker:G,ActivateBoxSelect:I,DeactivateBoxSelect:J,GetFeaturesInExtent:M,GetExtentForCoordinate:K,ActivateMeasure:N,DeactivateMeasure:O,TransformBox:P,ConvertGmlToGeoJson:Q,ExtentToGeoJson:R,AddZoom:S,AddZoomSlider:T,GetCenter:Z}},ISY.MapImplementation.Leaflet.Map.RENDERERS={canvas:"canvas",webgl:"webgl"};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.Leaflet=ISY.MapImplementation.Leaflet||{},ISY.MapImplementation.Leaflet.Sources=ISY.MapImplementation.Leaflet.Sources||{},ISY.MapImplementation.Leaflet.Sources.Tms=function(a){var b=18,c=a.format,d=a.format.indexOf("/");d>0&&(c=c.substr(d+1));var e=a.url;return Array.isArray(e)&&(e=a.url[0]),new L.TileLayer(e+"/tms/1.0.0/"+a.name+"@EPSG:32632@"+c+"/{z}/{x}/{y}."+c,{attribution:a.attribution,minZoom:0,maxZoom:b,tms:!0,continousWorld:!0})};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.Leaflet=ISY.MapImplementation.Leaflet||{},ISY.MapImplementation.Leaflet.Sources=ISY.MapImplementation.Leaflet.Sources||{},ISY.MapImplementation.Leaflet.Sources.Wms=function(a){var b=a.url;if(Array.isArray(b))for(var c=0;c<b.length;c++)b[c]+="?";else b+="?";return new L.TileLayer.WMS(b,{attribution:a.attribution,layers:a.name,format:a.format,transparent:!0,version:"1.0.0"})};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.AddFeatureGps=function(a){function b(b){var e=new ol.source.Vector,f=new ISY.MapImplementation.OL3.Styles.Measure;"Line"===j&&(j="LineString"),o=new ol.interaction.Draw({source:e,style:f.Styles(),type:j}),p=new ol.layer.Vector({source:e,style:f.DrawStyles()}),b.addInteraction(o),b.addLayer(p),c(b),d(b),o.on("drawstart",function(b){l=b.feature;var c=b.coordinate;s=l.getGeometry().on("change",function(b){var d,e=b.target;e instanceof ol.geom.Polygon?(d="",c=e.getInteriorPoint().getCoordinates()):e instanceof ol.geom.LineString&&(d="",c=e.getLastCoordinate()),a.TriggerEvent(ISY.Events.EventTypes.MeasureMouseMove,d)})},this),o.on("drawend",function(d){b.removeInteraction(r),l=null,ol.Observable.unByKey(s),l=d.feature;var e=new ol.Collection([l]);q=new ol.interaction.Modify({features:e,deleteCondition:function(a){return ol.events.condition.shiftKeyOnly(a)&&ol.events.condition.singleClick(a)}}),b.addInteraction(q),c(b),a.TriggerEvent(ISY.Events.EventTypes.AddLayerFeatureEnd,l),u=!0,q.on("modifyend",function(b){l=null,ol.Observable.unByKey(s),l=b.features.getArray()[0],a.TriggerEvent(ISY.Events.EventTypes.AddLayerFeatureEnd,l)},this),b.removeInteraction(o)},this)}function c(a){var b=new ol.Collection(k);r=new ol.interaction.Snap({features:b}),a.addInteraction(r)}function d(a){m&&null!==m.parentNode&&m.parentNode.removeChild(m),m=document.createElement("div"),m.className="tooltip hidden",n=new ol.Overlay({element:m,offset:[15,0],positioning:"center-left"}),a.addOverlay(n)}function e(a,c){console.log(a,c),t=!0,i=c.translate,j=c.toolType,k=c.snappingFeatures,a.on("pointermove",v),$(a.getViewport()).on("mouseout",function(){$(m).addClass("hidden")}),b(a)}function f(a){a.removeInteraction(o),a.removeOverlay(n),null!==m&&null!==m.parentNode&&m.parentNode.removeChild(m);for(var b=document.getElementsByClassName("tooltip tooltip-static");b.length>0;){var c=b[0];c.parentNode.removeChild(c)}}function g(a){t&&(t=!1,u=!1,l=null,void 0!==a&&(a.removeLayer(p),a.removeInteraction(q),a.removeInteraction(r),f(a)))}function h(a){console.log(a)}var i,j,k,l,m,n,o,p,q,r,s,t=!1,u=!1,v=function(a){if(t){var b=i.add_layer_start_drawing;l&&!u&&(b=i.add_layer_continue_drawing),u&&(b=i.add_layer_modify_object),m.innerHTML=b,n.setPosition(a.coordinate),$(m).removeClass("hidden")}};return{Activate:e,AddCoordinates:h,Deactivate:g}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.AddLayerFeature=function(a){function b(b){var e=new ol.source.Vector,f=new ISY.MapImplementation.OL3.Styles.Measure;"Line"===i&&(i="LineString"),n=new ol.interaction.Draw({source:e,style:f.Styles(),type:i}),o=new ol.layer.Vector({source:e,style:f.DrawStyles()}),b.addInteraction(n),b.addLayer(o),c(b),d(b);var g;n.on("drawstart",function(b){k=b.feature;var c=b.coordinate;g=k.getGeometry().on("change",function(b){var d,e=b.target;e instanceof ol.geom.Polygon?(d="",c=e.getInteriorPoint().getCoordinates()):e instanceof ol.geom.LineString&&(d="",c=e.getLastCoordinate()),a.TriggerEvent(ISY.Events.EventTypes.MeasureMouseMove,d)})},this),n.on("drawend",function(d){b.removeInteraction(q),k=null,ol.Observable.unByKey(g),k=d.feature;var e=new ol.Collection([k]);p=new ol.interaction.Modify({features:e,deleteCondition:function(a){return ol.events.condition.shiftKeyOnly(a)&&ol.events.condition.singleClick(a)}}),b.addInteraction(p),c(b),a.TriggerEvent(ISY.Events.EventTypes.AddLayerFeatureEnd,k),s=!0,p.on("modifyend",function(b){k=null,ol.Observable.unByKey(g),k=b.features.getArray()[0],a.TriggerEvent(ISY.Events.EventTypes.AddLayerFeatureEnd,k)},this)},this)}function c(a){var b=new ol.Collection(j);q=new ol.interaction.Snap({features:b}),a.addInteraction(q)}function d(a){l&&null!==l.parentNode&&l.parentNode.removeChild(l),l=document.createElement("div"),l.className="tooltip hidden",m=new ol.Overlay({element:l,offset:[15,0],positioning:"center-left"}),a.addOverlay(m)}function e(a,c){r=!0,h=c.translate,i=c.toolType,j=c.snappingFeatures,a.on("pointermove",t),$(a.getViewport()).on("mouseout",function(){$(l).addClass("hidden")}),b(a)}function f(a){a.removeInteraction(n),a.removeOverlay(m),null!==l&&null!==l.parentNode&&l.parentNode.removeChild(l);for(var b=document.getElementsByClassName("tooltip tooltip-static");b.length>0;){var c=b[0];c.parentNode.removeChild(c)}}function g(a){r&&(r=!1,s=!1,k=null,void 0!==a&&(a.removeLayer(o),a.removeInteraction(p),a.removeInteraction(q),f(a)))}var h,i,j,k,l,m,n,o,p,q,r=!1,s=!1,t=function(a){if(r){var b=h.add_layer_start_drawing;k&&!s&&(b=h.add_layer_continue_drawing),s&&(b=h.add_layer_modify_object),l.innerHTML=b,m.setPosition(a.coordinate),$(l).removeClass("hidden")}};return{Activate:e,Deactivate:g}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.DrawFeature=function(a){function b(b){h=new ol.layer.Vector({map:b,source:new ol.source.Vector({useSpatialIndex:!1}),updateWhileAnimating:!0,updateWhileInteracting:!0});var e="Polygon",f=new ol.source.Vector,i=new ISY.MapImplementation.OL3.Styles.Measure;o=new ol.interaction.Draw({source:f,style:i.DrawStyles(),type:e}),p=new ol.layer.Vector({source:f,style:i.DrawStyles()}),b.addInteraction(o),b.addLayer(p),d(b),c(b);var k;o.on("drawstart",function(a){j=a.feature;var b=j.getGeometry().getCoordinates()[0][0];g=new ol.Feature(new ol.geom.Circle(b,0)),h.getSource().addFeature(g)},this),o.on("drawend",function(c){m.className="tooltip tooltip-static",n.setOffset([0,-7]),j=null,m=null,d(b),ol.Observable.unByKey(k),j=c.feature,a.TriggerEvent(ISY.Events.EventTypes.DrawFeatureEnd,j.getGeometry().getCoordinates())},this)}function c(a){k&&null!==k.parentNode&&k.parentNode.removeChild(k),k=document.createElement("div"),k.className="tooltip hidden",l=new ol.Overlay({element:k,offset:[15,0],positioning:"center-left"}),a.addOverlay(l)}function d(a){m&&null!==m.parentNode&&m.parentNode.removeChild(m),m=document.createElement("div"),m.className="tooltip tooltip-measure",n=new ol.Overlay({element:m,offset:[0,-15],positioning:"bottom-center"}),a.addOverlay(n)}function e(a,c){q=!0,i=c.translate,a.on("pointermove",s),$(a.getViewport()).on("mouseout",function(){$(k).addClass("hidden")}),b(a)}function f(b){if(q){if(q=!1,void 0!==b){b.removeLayer(p),m.className="tooltip tooltip-static",n.setOffset([0,-7]),m=null,b.removeInteraction(o),b.removeOverlay(h),b.removeOverlay(n),b.removeOverlay(l),k&&k.parentNode.removeChild(k),m&&m.parentNode.removeChild(m);for(var c=document.getElementsByClassName("tooltip tooltip-static");c.length>0;){var d=c[0];d.parentNode.removeChild(d)}}a.TriggerEvent(ISY.Events.EventTypes.MeasureEnd)}}var g,h,i,j,k,l,m,n,o,p,q=!1,r="Click to continue drawing the line",s=function(a){if(!a.dragging&&q){var b=i.start_drawing;if(j){var c=j.getGeometry();c instanceof ol.geom.Polygon?b=i.continue_drawing:c instanceof ol.geom.LineString&&(b=r)}k.innerHTML=b,l.setPosition(a.coordinate),$(k).removeClass("hidden")}};return{Activate:e,Deactivate:f}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Export=function(){function a(a,b,c){i=a.layout,j=!0,h=e(b),g=[b.on("precompose",k),b.on("postcompose",l)],c()}function b(a){if(j=!1,g){for(var b=0;b<g.length;b++)g[b].src.unByKey(g[b]);a()}}function c(a,b){b.once("postcompose",function(b){var c=b.context.canvas;a(c,h)})}function d(a){j&&(h=e(a),a.render())}function e(a){var b,c,d=210/297,e=a.getSize();"a4portrait"===i.value?(c=e[1]*d,c>e[0]?(c=e[0],b=e[0]/d):b=e[1]):(b=e[0]*d,b>e[1]?(b=e[1],c=e[1]/d):c=e[0]);var f=[e[0]*ol.has.DEVICE_PIXEL_RATIO/2,e[1]*ol.has.DEVICE_PIXEL_RATIO/2];return{minx:f[0]-c/2,miny:f[1]-b/2,maxx:f[0]+c/2,maxy:f[1]+b/2}}function f(a){var b=a.getSize();return{height:b[1]*ol.has.DEVICE_PIXEL_RATIO,width:b[0]*ol.has.DEVICE_PIXEL_RATIO}}var g,h,i="",j=!1,k=function(a){var b=a.context;b.save()},l=function(a){var b=a.context,c=f(a.target);b.beginPath(),b.moveTo(0,0),b.lineTo(c.width,0),b.lineTo(c.width,c.height),b.lineTo(0,c.height),b.lineTo(0,0),b.closePath(),b.moveTo(h.minx,h.miny),b.lineTo(h.minx,h.maxy),b.lineTo(h.maxx,h.maxy),b.lineTo(h.maxx,h.miny),b.lineTo(h.minx,h.miny),b.closePath(),b.fillStyle="rgba(25, 25, 25, 0.75)",b.fill(),b.restore()};return{Activate:a,Deactivate:b,ExportMap:c,WindowResized:d}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.FeatureEditor=function(a){function b(b,c,d,e,f,g){void 0===d&&(d="http://kart4.nois.no/skjema/va"),l=new ISY.MapImplementation.OL3.Sources.WfsT(b,c,d,e,f,a),k=g}function c(a,b){void 0!==b&&(i=b.on("singleclick",function(b){a(b.coordinate)}))}function d(a){void 0!==a&&(a.unByKey(i),i="")}function e(a){var b=new ol.geom.Point(a);j.push(b);var c=new ol.Feature({navn:"ISY.MapLib-"+l.GetFeatureType()+"-Insert"});c.setGeometryName(k),c.setGeometry(b),l.InsertFeature(c)}function f(a){l.UpdateFeature(a)}function g(a,b){return l.InsertFeature(a,b)}function h(a){return l.DeleteFeature(a)}var i="",j=[],k="",l=null;return{Init:b,ActivateEditSelect:c,DeactivateEditSelect:d,HandlePointSelect:e,UpdateFeature:f,InsertFeature:g,DeleteFeature:h}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.FeatureInfo=function(){function a(a,c){s(c),b();for(var d=new ol.format.GeoJSON,e=0;e<a.length;e++){var f=a[e];if(void 0!==f.geometryObject){var g=d.readFeature(f.geometryObject);f.crs&&g.getGeometry().transform(ol.proj.get(f.crs),ol.proj.get(c.getView().getProjection().getCode())),f.hoverstyle&&g.setStyle(f.hoverstyle),x.getSource().addFeature(g)}else x.getSource().addFeature(f)}}function b(){if(null!==x){var a=x.getSource();a.clear()}}function c(a,b,c){var d=$(b),e=d.height(),f=d.width(),g=new ol.Overlay({element:b,stopEvent:!1,offset:[-f/2,-e]});g.setPosition(a),c.addOverlay(g)}function d(a,b){void 0!==w&&b.removeOverlay(w)}function e(a,b,c,d){var e=d.getResolution(),f=b.getSource(),g=d.getProjection(),h=f.getGetFeatureInfoUrl(c,e,g,{INFO_FORMAT:a.featureInfo.getFeatureInfoFormat,feature_count:10}),i=decodeURIComponent(h),j=i.substring(i.lastIndexOf("?"),i.length).replace("?",""),k=encodeURIComponent(j);return a.url[0]+"?"+k}function f(a,b){void 0!==b&&(z=b.on("singleclick",function(b){a(b.coordinate)}))}function g(a){void 0!==a&&(a.unByKey(z),z="")}function h(a,b){v=new ol.interaction.DragBox({condition:ol.events.condition.always}),b.addInteraction(v),v.on("boxend",function(){a(v.getGeometry().getExtent())})}function i(a){void 0!==a&&a.removeInteraction(v)}function j(a,b){var c=a.getMinResolution();if(c>0&&c>b)return!1;var d=a.getMaxResolution();return d!==1/0&&b>d?!1:!0}function k(a,b,c){if(void 0===b||void 0===a)return void 0;if(!j(b,c))return void 0;var d=b.getSource(),e=[];d.forEachFeatureInExtent(a,function(b){var c=b.getGeometry(),d=b.get("isHidden");d=void 0===d?!1:d,d||void 0!==c&&c.intersectsExtent(a)&&e.push(b)});var f=new ol.format.GeoJSON,g=f.writeFeaturesObject(e);if(Array.isArray(g.features))for(var h=0;h<g.features.length;h++)g.features[h].olFeature=e[h];else g.features.olFeature=Array.isArray(e)?e[0]:e;var i=d.getProjection();return i&&(g.crs=o(i.getCode())),g}function l(a){if(null!==a){var b=a.getSource(),c=b.getFeatures(),d=new ol.format.GeoJSON,e=d.writeFeaturesObject(c),f=b.getProjection();return f&&(e.crs=o(b.getProjection().getCode())),e}}function m(a){if(null!==a){var b=a.getSource();return b.getFeatures()}}function n(a){var b=new ol.format.GeoJSON,c=b.readFeature(a.geometryObject);return c.getGeometry().getExtent()}function o(a){return new p(a.split(":"))}function p(a){this.type=a[0],this.properties=new q(a[1])}function q(a){this.code=a}function r(a,b,c){var d=b*c,e=a[0],f=a[1],g=e-d,h=f-d,i=e+d,j=f+d;return[g,h,i,j]}function s(a){if(null==x){null==y&&u();var b=new ol.source.Vector({projection:"EPSG:4326",object:{type:"FeatureCollection",totalFeatures:1,features:[{type:"Feature",id:"thc.1",geometry:{type:"Point",coordinates:[21.7495,71.721]},geometry_name:"the_geom",properties:{Year:2003}}],crs:{type:"EPSG",properties:{code:"4326"}}}});x=new ol.layer.Vector({source:b,style:y}),a.addLayer(x)}else a.removeLayer(x),a.addLayer(x)}function t(a){y=a,x.setStyle(y)}function u(){var a=new ISY.MapImplementation.OL3.Styles.Default;y=a.Styles}var v,w,x=null,y=null,z="";return{ShowHighlightedFeatures:a,ClearHighlightedFeatures:b,SetHighlightStyle:t,ShowInfoMarker:c,RemoveInfoMarker:d,GetFeatureInfoUrl:e,ActivateInfoClick:f,DeactivateInfoClick:g,ActivateBoxSelect:h,DeactivateBoxSelect:i,GetFeaturesInExtent:k,GetExtentForCoordinate:r,GetFeatureCollection:l,GetFeatureExtent:n,GetFeaturesInMap:m}},ISY=ISY||{},ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.HoverInfo=function(){function a(a,b,d,e){n=d,c(e),l(a)}function b(a){if(void 0!==a)switch(v=!1,d(),u){case 1:m&&(m.setActive(!1),a.removeInteraction(m),m=void 0,w=!1)}}function c(a){a&&a.multiSelect&&(t=a.multiSelect)}function d(){if(void 0!==q){var a=q.getElement();$(a).popover("destroy"),p&&o&&(o.getSource().removeFeature(p),p=void 0)}}function e(a,b){var c=[];return a.forEachFeatureAtPixel(b,function(a){var b=parseInt(n.GetLayerByFeature(a).guid,10);c.push({feature:a,zindex:b})}),c=h(c),void 0===c?void 0:c[0].feature}function f(a){var b=[];return a.forEach(function(a){var c=n.GetLayerByFeature(a);if(c){var d=parseInt(c.guid,10);b.push({feature:a,zindex:d})}}),b=h(b),void 0===b?void 0:b[0].feature}function g(a,b){return a.zindex<b.zindex?1:a.zindex>b.zindex?-1:0}function h(a){return 0===a.length?void 0:(a.sort(g),a)}function i(a,b){v&&(r=a.getEventPixel(b.originalEvent),s=b.coordinate,q&&q.setPosition(s))}function j(a,b){var c,d,g;switch(u){case 1:c=b;break;case 2:c=b.originalEvent,g=a.getEventPixel(c)}switch(u){case 1:d=f(c.target.getFeatures().getArray());break;case 2:d=e(a,g)}void 0===q&&(q=new ol.Overlay({element:document.getElementById("popup")}),a.addOverlay(q));var h=q.getElement();if(d){var i=d.getProperties();if(void 0!==i){var j;switch(u){case 1:j=s;break;case 2:j=b.coordinate}$(h).popover("destroy"),q.setPosition(j);var k="",l=n.GetLayerByFeature(d),m=l.tooltipTemplate;if(m){for(var r,t,v,w="",x=m.indexOf("{");x>=0;)x>0&&(w+=m.substr(0,x),m=m.slice(x),x=m.indexOf("{")),v=m.indexOf("}"),r=m.substr(x+1,v-x-1),t=d.get(r),t&&(w+=t),m=m.slice(v+1),x=m.indexOf("{");k=w+m}k.length>0?($(h).popover({placement:"top",animation:!1,html:!0,content:'<div class="hover-info">'+k+"</div>"}),$(h).popover("show")):$(h).popover("destroy")}}else $(h).popover("destroy");d!==p&&(p&&o.getSource().removeFeature(p),d&&o.getSource().addFeature(d),p=d)}function k(a,b){return n.GetHoverStyle(a,b)}function l(a){if(!v)if(v=!0,w)switch(u){case 1:a.addInteraction(m),m.setActive(!0)}else switch(w=!0,o=new ol.layer.Vector({map:a,source:new ol.source.Vector({useSpatialIndex:!1}),style:k,updateWhileAnimating:!0,updateWhileInteracting:!0}),u){case 1:m=new ol.interaction.Select({condition:ol.events.condition.pointerMove,multi:t,style:function(a,b){return n.GetHoverStyle(a,b)}}),a.addInteraction(m),m.on("select",function(b){v&&(b.dragging||j(a,b))}),x||(x=!0,a.on("pointermove",function(b){i(a,b)}));break;case 2:a.on("pointermove",function(b){v&&(b.dragging||j(a,b))})}}var m,n,o,p,q,r,s,t=!1,u=1,v=!1,w=!1,x=!1;return{ActivateHoverInfo:a,DeactivateHoverInfo:b}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Map=function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){Rb=b.proxyHost,Sb=b.tokenHost,Eb=b.groups,Db=b.hoverOptions;var c=b.numZoomLevels,d=[];d[0]=b.newMaxRes,Cb=[],Cb[0]=b.newMaxScale;for(var e=1;c>e;e++)d[e]=d[e-1]/2,Cb[e]=Cb[e-1]/2;Bb=d;var f=new ol.proj.Projection({code:b.coordinate_system,extent:b.extent,units:b.extentUnits});Ab=new ol.Map({target:a,renderer:b.renderer,layers:[],loadTilesWhileAnimating:!0,view:new ol.View({projection:f,enableRotation:!1,center:b.center,zoom:b.zoom,resolutions:d,maxResolution:b.newMaxRes,numZoomLevels:c}),controls:[],overlays:[]}),eb(),o(),b.showProgressBar&&q(),b.showMousePosition&&r(b.mouseProjectionPrefix),p()}function o(){var a=Ab.getView(),c=function(){var a=$b();b.TriggerEvent(ISY.Events.EventTypes.ChangeCenter,a)},d=function(){var a=$b();b.TriggerEvent(ISY.Events.EventTypes.ChangeResolution,a)},e=function(){s();var a=$b();b.TriggerEvent(ISY.Events.EventTypes.MapMoveend,a)};a.on("change:center",c),a.on("change:resolution",d),Ab.on("moveend",e)}function p(){var a=new ISY.MapImplementation.OL3.Sources.CustomMessageHandler(b,N);a.Init(Ab),Lb=new ISY.MapImplementation.OL3.Sources.CustomMessageHandler,Lb.InitMessage("")}function q(){var a=new ISY.MapImplementation.OL3.ProgressBar(b);a.Init(Ab)}function r(a){var b=document.getElementById("mouseposition");if(b){var c=Ab.getView().getProjection().getUnits(),d=hc();void 0===a&&(a="");var e=function(b){var e=""+a,f=!1;if(e.length>0)switch(c){case"degrees":e="",f=!0;break;case"m":switch(d){case"EPSG:25831":case"EPSG:32631":e+="31 ";break;case"EPSG:25832":case"EPSG:32632":e+="32 ";break;case"EPSG:25833":case"EPSG:32633":e+="33 ";break;case"EPSG:25834":case"EPSG:32634":e+="34 ";break;case"EPSG:25835":case"EPSG:32635":e+="35 ";break;case"EPSG:25836":case"EPSG:32636":e+="36 ";break;case"EPSG:25837":case"EPSG:32637":e+="37 ";break;case"EPSG:25838":case"EPSG:32638":e+="38 "}}return e+=f?Math.round(1e4*b[1])/1e4+Gb.north+Math.round(1e4*b[0])/1e4+Gb.east:parseInt(b[1],10)+Gb.north+parseInt(b[0],10)+Gb.east},f=new ol.control.MousePosition({coordinateFormat:e,projection:d,className:"mousePosition",target:b});Ab.addControl(f)}}function s(){var a=(new Date).getTime();Ub+6e4>a||(Ub=a,Ab.getLayers()&&Ab.getLayers().forEach(function(b){var c=b.getSource();if(c&&c.getParams){var d=c.getParams();if(d&&d.GKT){var e=c.get("timestamp");if(e){var f=Math.round((a-e)/1e3);f>Tb&&t(c)}}}}))}function t(a){a.updateParams({GKT:E()}),a.set("timestamp",(new Date).getTime())}function u(a){if(void 0!==Ab){var b,c,d,e=Ab.getView();if(a.lon&&(b=a.lon),a.lat&&(c=a.lat),a.zoom&&(d=a.zoom),void 0!==b&&void 0!==c){var f="number"==typeof c?c:parseFloat(c.replace(/,/g,".")),g="number"==typeof b?b:parseFloat(b.replace(/,/g,"."));isFinite(f)&&isFinite(g)&&e.setCenter([g,f])}void 0!==d&&e.setZoom(d)}}function v(a,b){var c=K(a);if(a.format===ISY.Domain.SubLayer.FORMATS.geoJson){var d=JSON.parse(b),e=new ol.format.GeoJSON,f=e.readFeatures(d);if(a.id&&a.name)for(var g=0;g<f.length;++g)void 0===f[g].getProperties().Guid&&f[g].setProperties({Guid:(new ISY.Utils.Guid).NewGuid()}),f[g].setId(a.name+"."+f[g].getProperties().Guid);c.getSource().addFeatures(f)}}function w(a,b){var c=K(a);if(a.format===ISY.Domain.SubLayer.FORMATS.geoJson)for(var d=JSON.parse(b),e=new ol.format.GeoJSON,f=e.readFeatures(d),g=0;g<f.length;++g)if(f[g].getProperties().Guid){var h=c.getSource().getFeatureById(a.name+"."+f[g].getProperties().Guid);h&&c.getSource().removeFeature(h)}}function x(a){var b=K(a);void 0!==b&&b.getSource().clear()}function y(a){var b=!1;return Ab.getLayers().forEach(function(c){b||c.guid!==a.id||(b=!0)}),b}function z(a){if(!y(a)){var b=G(a);b&&(b.sortingIndex=a.sortingIndex,Ab.addLayer(b),ca())}}function A(a){var b=K(a);return null!==b?mc(b):void 0}function B(a){if(!y(a)){var b=G(a);b&&(Ab.getLayers().insertAt(0,b),ca())}}function C(a){if(y(a)){var b=V(a.id);b&&(Ab.removeLayer(b),ca())}}function D(a,b){if(Array.isArray(a)&&(a=a[0]),b)return Array.isArray(Rb)?Rb[0]+a:Rb+a;if(!Array.isArray(Rb))return Rb+a;for(var c=[],d=0;d<Rb.length;d++)c.push(Rb[d]+a);return c}function E(){return Sb?$.ajax({type:"GET",url:"https://www.norgeskart.no/ws/gkt.py",async:!1}).responseText.trim().replace(/\"/g,""):null}function F(a,c){a.set("config",c),a.on("change",function(){a.set("loading",!0)},a),a.on("render",function(){a.get("loading")&&(a.set("loading",void 0),b.TriggerEvent(ISY.Events.EventTypes.LoadingLayerEnd,a))},a)}function G(a){var c,d,e,f=K(a),g=!0;Hb&&Hb.length>0&&(e={isyToken:Hb});var h=function(d){c.set("config",a);var e=Ob[a.id].ParseSld(d,parseInt(a.id,10));e.maxScaleDenominator&&I(c,Wb(e.maxScaleDenominator),"styleCallback"),e.minScaleDenominator&&H(c,Wb(e.minScaleDenominator),"styleCallback"),M(a),Mb.push(c),c.sortingIndex=a.sortingIndex,Ab.addLayer(c),b.TriggerEvent(ISY.Events.EventTypes.LayerCreated,Mb),Z(),ca()};if(null!=f)c=f,c.set("config",a);else{switch(a.source){case ISY.Domain.SubLayer.SOURCES.wmts:d=new ISY.MapImplementation.OL3.Sources.Wmts(a,e);break;case ISY.Domain.SubLayer.SOURCES.proxyWmts:a.url=D(a.url),d=new ISY.MapImplementation.OL3.Sources.Wmts(a,e);break;case ISY.Domain.SubLayer.SOURCES.wms:d=new ISY.MapImplementation.OL3.Sources.Wms(a,e),a.gatekeeper&&a.tiled&&(void 0===j?!0:!j.IsActive())&&t(d);break;case ISY.Domain.SubLayer.SOURCES.proxyWms:a.url=D(a.url),d=new ISY.MapImplementation.OL3.Sources.Wms(a,e);break;case ISY.Domain.SubLayer.SOURCES.vector:d=new ISY.MapImplementation.OL3.Sources.Vector(a),""!==a.url&&(a.noProxy||(a.url=D(a.url)),J(a,d));break;case ISY.Domain.SubLayer.SOURCES.wfs:a.noProxy||(a.url=D(a.url,!0)),d=new ISY.MapImplementation.OL3.Sources.Wfs(a,j,e);break;default:throw"Unsupported source: ISY.Domain.SubLayer.SOURCES.'"+a.source+"'. For SubLayer with url "+a.url+" and name "+a.name+"."}a.source===ISY.Domain.SubLayer.SOURCES.vector?a.style?"object"==typeof a.style||a.style.indexOf("http")<0?(Ob[a.id]=new ISY.MapImplementation.OL3.Styles.Json(a.style),c=new ol.layer.Vector({source:d,style:function(b,c){return Ob[a.id].GetStyle(b,Vb(c))}})):(Ob[a.id]=new ISY.MapImplementation.OL3.Styles.Sld,c=new ol.layer.Vector({source:d,style:function(b,c){return Ob[a.id].GetStyle(b,Vb(c))}}),a.style&&(g=!1,mb(a.style,"application/xml",h)),F(c,a)):c=new ol.layer.Vector({source:d}):a.source===ISY.Domain.SubLayer.SOURCES.wfs?(Ob[a.id]=new ISY.MapImplementation.OL3.Styles.Sld,c=new ol.layer.Vector({source:d,style:function(b,c){return Ob[a.id].GetStyle(b,Vb(c))}}),a.style&&(g=!1,mb(a.style,"application/xml",h)),F(c,a)):c=a.tiled?new ol.layer.Tile({extent:a.extent,opacity:a.opacity,source:d}):new ol.layer.Image({extent:a.extent,opacity:a.opacity,source:d}),c.set("config",a),c.layerIndex=a.layerIndex,c.guid=a.id,c.typename=a.name,c.tooltipTemplate=a.tooltipTemplate,void 0!==a.minResolution&&c.setMinResolution(a.minResolution),void 0!==a.maxResolution&&c.setMaxResolution(a.maxResolution),a.maxScale&&H(c,Wb(a.maxScale),"layer"),a.minScale&&I(c,Wb(a.minScale),"layer"),g&&(M(a),Mb.push(c))}return g?c:void 0}function H(a,b){if(a&&b){var c=a.getMinResolution();if(c&&c>=b)return;a.setMinResolution(b)}}function I(a,b){if(a&&b){var c=a.getMaxResolution();if(c&&b>=c)return;a.setMaxResolution(b)}}function J(a,b){var c=function(a){for(var c=new ol.format.GeoJSON,d=0;d<a.features.length;d++){var e=a.features[d];e.type&&b.addFeature(c.readFeature(e))}};$.ajax({url:a.url+"request=GetFeature&typeName="+a.name+"&outputFormat=json",async:!1}).done(function(a){c(a)})}function K(a){for(var b=0;b<Mb.length;b++){var c=Mb[b];if(c.guid==a.id)return c}return null}function L(a){for(var b=0;b<Mb.length;b++){var c=Mb[b];if(c.guid==a)return c}return null}function M(a){for(var b=!1,c=0;c<Nb.length;c++)if(a.id===Nb[c].id){b=!0;break}b||Nb.push(a)}function N(a){for(var b,c=0;c<Nb.length;c++)if(Nb[c].id===a.guid){b=Nb[c];break}return b}function O(a){var b=a.get("layerguid");if(void 0===b){if(b=a.getId(),void 0===b)return null;if(b.indexOf(".")>0)b=b.slice(0,b.indexOf("."));else{var c=b.substr(0,b.indexOf("_"))+":"+b.substr(b.indexOf("_")+1);b=c.slice(0,c.indexOf("_"))}for(var d=0;d<Mb.length;d++){var e=Mb[d],f=e.typename;if(f.indexOf(":")>0&&(f=f.slice(f.indexOf(":")+1)),f===b)return e}}else for(var g=0;g<Mb.length;g++)if(b===Mb[g].guid)return Mb[g];return null}function P(a,b){var c=V(a.id);c&&!isNaN(b)&&c.setBrightness(Math.min(b,1))}function Q(a,b){var c=V(a.id);c&&!isNaN(b)&&c.setContrast(Math.min(b,1))}function R(a,b){var c=V(a.id);c&&!isNaN(b)&&c.setOpacity(Math.min(b,1))}function S(a,b){var c=V(a.id);c&&!isNaN(b)&&c.setSaturation(Math.min(b,1))}function T(a,b){var c=V(a.id);c&&!isNaN(b)&&c.setHue(Math.min(b,1))}function U(){return Ab.getLayers().getArray().filter(function(a){return void 0!==a.guid})}function V(a){for(var b=U(),c=0;c<b.length;c++){var d=b[c];if(d.guid==a)return d}return null}function W(a){for(var b=U(),c=0;c<b.length;c++){var d=b[c];if(d.guid==a.id)return c}return null}function X(a){for(var b=U(),c=0;c<b.length;c++)if(b[c].get("title")==a)return b[c];return null}function Y(a,b){for(var c=W(a),d=Ab.getLayers().getArray(),e=0;e<d.length;e++)if(void 0===d[e].guid){d.splice(e,1);break}d.splice(b,0,d.splice(c,1)[0]),ca()}function Z(){var a=Ab.getLayers().getArray();_(a,"sortingIndex"),ca()}function _(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return d>e?-1:e>d?1:0})}function aa(a){for(var b=Ab.getLayers().getArray(),c=0;c<b.length;c++)if(b[c].guid===a)return b[c];return void 0}function ba(a){for(var b=0;b<a.length&&void 0!==a[b].isyLayers;b++)for(var c=0;c<a[b].isyLayers.length;c++)for(var d=0;d<a[b].isyLayers[c].subLayers.length;d++){var e=aa(a[b].isyLayers[c].subLayers[d].id);void 0!==e&&(e.sortingIndex=a[b].isyLayers[c].subLayers[d].sortingIndex)}}function ca(){var a=$b();b.TriggerEvent(ISY.Events.EventTypes.ChangeLayers,a)}function da(){for(var a=[],b=U(),c=0;c<b.length;c++){var d=b[c];d.getVisible()===!0&&a.push(b[c])}a.sort(ea);for(var e=[],f=0;f<a.length;f++)e.push(a[f].guid);return e.join(",")}function ea(a,b){return a.mapLayerIndex<b.mapLayerIndex?-1:a.mapLayerIndex>b.mapLayerIndex?1:0}function fa(a){f.Activate(a,Ab,ia),window.addEventListener("resize",Xb,!1)}function ga(){window.removeEventListener("resize",Xb,!1),f.Deactivate(ia)}function ha(a){f.ExportMap(a,Ab)}function ia(){Ab&&Ab.updateSize()}function ja(){Ab.getLayers().forEach(function(a){ma(a)})}function ka(a,b){a&&ma(L(a),void 0,b)}function la(a,b){ma(K(a),a,b)}function ma(a,c,d){if(void 0!==a&&(void 0===c&&(c=N(a)),void 0!==c)){var e;Hb&&Hb.length>0&&(e={isyToken:Hb});var f;switch(c.source){case ISY.Domain.SubLayer.SOURCES.wmts:f=new ISY.MapImplementation.OL3.Sources.Wmts(c,e);break;case ISY.Domain.SubLayer.SOURCES.proxyWmts:f=new ISY.MapImplementation.OL3.Sources.Wmts(c,e);break;case ISY.Domain.SubLayer.SOURCES.wms:f=new ISY.MapImplementation.OL3.Sources.Wms(c,e),c.gatekeeper&&c.tiled&&(void 0===j?!0:!j.IsActive())&&t(f);break;case ISY.Domain.SubLayer.SOURCES.proxyWms:f=new ISY.MapImplementation.OL3.Sources.Wms(c,e);break;case ISY.Domain.SubLayer.SOURCES.vector:f=new ISY.MapImplementation.OL3.Sources.Vector(c),""!==c.url&&J(c,f);break;case ISY.Domain.SubLayer.SOURCES.wfs:e._olSalt=Math.random(),f=new ISY.MapImplementation.OL3.Sources.Wfs(c,j,e,d,b)}f&&a.setSource(f)}}function na(a){Lb.ShowCustomMessage(a)}function oa(){Ab.renderSync()}function pa(a){e.ActivateInfoClick(a,Ab)}function qa(){e.DeactivateInfoClick(Ab)}function ra(a,b){return Rb+e.GetFeatureInfoUrl(a,K(a),b,Ab.getView())}function sa(a,b){e.ShowHighlightedFeatures(Pa(a,b),Ab)}function ta(){e.ClearHighlightedFeatures()}function ua(a,b){e.ShowInfoMarker(a,b,Ab);
}function va(a){e.RemoveInfoMarker(a,Ab)}function wa(a){e.SetHighlightStyle(a)}function xa(a){e.ActivateBoxSelect(a,Ab)}function ya(){e.DeactivateBoxSelect(Ab)}function za(a){if(""===a.featureNS||void 0===a.featureNS)return!1;var b=K(a);return null!=b?(Pb.Init(a.url,a.name,a.featureNS,a.coordinate_system,b.getSource(),a.geometryName),!0):(G(a),void za(a))}function Aa(a,b,c,d,e){var f=Array.prototype.slice.call(d.getElementsByTagName(a),0),g=function(a){return e?a.getAttribute(b).toLowerCase()===c.toLowerCase():a.getAttribute(b).indexOf(c)>-1||c.indexOf(a.getAttribute(b))>-1};return f.where(g)}function Ba(a){var c=Ib.name.split(":");if(c.length>0){c=c[c.length-1];var d=Aa("element","name",c,a,!0)[0],e=Aa("element","type",Kb,d,!1)[0];if(void 0!==e){e=e.getAttribute("name");var f=a.firstChild.getAttribute("targetNamespace");if("undefined"==typeof Jb.format){var g;switch(Ib.version){case"1.0.0":g=new ol.format.GML2;break;case"1.1.0":g=new ol.format.GML3;break;case"2.0.0":g=new ol.format.GML3;break;default:g=new ol.format.GML}Jb.format=new ol.format.WFS({featureType:Ib.providerName,featureNS:f,gmlFormat:g})}Ib.featureNS=f,Ib.geometryName=e,b.TriggerEvent(ISY.Events.EventTypes.FeatureHasBeenDescribed,[Ib,Jb])}}}function Ca(a,b){Ib=a,Kb=b;var c=ol.proj.get(a.coordinate_system);Jb=new ol.source.Vector({projection:c}),Jb.set("type","ol.source.Vector");var d=a.url;Array.isArray(a.url)&&(d=a.url[0]),d.toLowerCase().indexOf("service=wfs")<0&&(d+="service=WFS&"),d+="request=DescribeFeatureType&version="+a.version+"&typename="+a.name,$.ajax({url:d}).done(function(a){Ba(a)})}function Da(a){Pb.ActivateEditSelect(a,Ab)}function Ea(){Pb.DeactivateEditSelect(Ab)}function Fa(a){Pb.HandlePointSelect(a)}function Ga(a){Pb.UpdateFeature(a)}function Ha(a,b){return Pb.InsertFeature(a,b)}function Ia(a){return Pb.DeleteFeature(a)}function Ja(a,b){return e.GetExtentForCoordinate(a,b,Ab.getView().getResolution())}function Ka(a,b){return e.GetFeaturesInExtent(b,K(a),Ab.getView().getResolution())}function La(a){return e.GetFeatureCollection(K(a))}function Ma(a){return e.GetFeaturesInMap(K(a))}function Na(a){return O(a)}function Oa(a,b){var c=this.GetLayerByFeature(a);return c?Ob[c.guid]?Ob[c.guid].GetHoverStyle(a,Vb(b)):c.getStyle?c.getStyle():void 0:void 0}function Pa(a,b){if(void 0===a)return b;for(var c,d=Vb(Ab.getView().getResolution()),e=function(a){for(var b=0;b<c.attributes.length;b++)if(a===c.attributes[b][0])return c.attributes[b][1]},f=0;f<b.length;f++){c=b[f],void 0===b[f].get&&(b[f].get=e);var g=Ob[a].GetHoverStyle(b[f],d);g&&(b[f].hoverstyle=g)}return b}function Qa(a){return e.GetFeatureExtent(a)}function Ra(a){g.ActivateHoverInfo(Ab,a,this,Db)}function Sa(){g.DeactivateHoverInfo(Ab)}function Ta(a,b){d.Activate(Ab,a,b)}function Ua(){d.Deactivate(Ab)}function Va(a,b){h.Activate(Ab,a,b)}function Wa(){h.Deactivate(Ab)}function Xa(a){k.Activate(Ab,a)}function Ya(){k.Deactivate(Ab)}function Za(a){m.Activate(Ab,a)}function $a(a){m.AddCoordinates(a)}function _a(){m.Deactivate(Ab)}function ab(a){l.Activate(Ab,a)}function bb(){l.Deactivate(Ab)}function cb(a,b){i.Activate(Ab,a,b)}function db(){i.Deactivate(Ab)}function eb(){j&&j.Init(Ab,b)}function fb(){j&&j.Activate()}function gb(a,c,d){j&&j.StartCaching(a,c,d,b)}function hb(){j.StopCaching()}function ib(a,b,c){j.DeleteDatabase(a,b,c)}function jb(){return j.CacheDatabaseExist()}function kb(a,b,c){return j?j.CalculateTileCount(a,b,c):void 0}function lb(a,b,c){j&&j.GetResource(a,b,c)}function mb(a,b,c){j&&j.GetConfigResource(a,b,c)}function nb(a,b,c){j&&j.GetResourceFromJson(a,b,c)}function ob(a,b,c){j&&j.GetLayerResource(a,b,c)}function pb(){j&&j.Deactivate()}function qb(a,b){if(""!==a.epsg&&""!==b&&a.epsg!=b){var c=ol.proj.transform([a.lon,a.lat],a.epsg,b);"EPSG:4326"===b&&(c=[c[1],c[0]]),a.lon=c[0],a.lat=c[1],a.epsg=b}return a}function rb(a,b,c){var d=c;if(""!==a&&""!==b&&a!=b){var e=ol.proj.transformExtent(c,a,b);d=e,"EPSG:4326"===b&&(d=e[1]+","+e[0]+","+e[3]+","+e[2])}return d}function sb(a){var b=new ol.format.WMSCapabilities,c=b.read(a),d=new ol.format.GML,e=d.readFeatures(c),f=new ol.format.GeoJSON;return f.writeFeatures(e)}function tb(a,b){var c=new ol.geom.Point([a,b]),d=new ol.Feature;d.setGeometry(c);var e=new ol.format.GeoJSON;return e.writeFeature(d)}function ub(){var a=new ol.control.Zoom;Ab.addControl(a)}function vb(){var a=new ol.control.ZoomSlider;Ab.addControl(a)}function wb(a){var b=new ol.control.ZoomToExtent({extent:a});Ab.addControl(b)}function xb(a){var b=new ol.layer.Vector({source:new ol.source.Vector,projection:Ab.getView().getProjection()});b.guid=a,Ab.addLayer(b),ca()}function yb(a,b){var c=V(99999);if(null!==c){var d=c.getSource();d.clear();var e=new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"rgba(255,255,255,0.8)",width:2}),fill:new ol.style.Fill({color:"rgba(32,170,172,0.8)"})}),fill:new ol.style.Fill({color:"rgba(0,102,204,0.15)"}),zIndex:1/0}),f=new ol.Feature({geometry:new ol.geom.GeometryCollection([new ol.geom.Point(a),new ol.geom.Circle(a,parseInt(b,10))]),name:"geolocation_center"});if(f.setStyle(e),d.addFeature(f),Qb){Qb=!1;var g=f.getGeometry().getExtent();g[0]-=5*b,g[1]-=5*b,g[2]+=5*b,g[3]+=5*b,Ab.getView().fit(g,Ab.getSize())}}}function zb(){var a=Ab.getView(),c=Fb.getPosition();if(void 0!==c){a.setCenter(c),yb(c,Fb.getAccuracy());var d={center:c,accuracy:Math.round(10*Fb.getAccuracy())/10,altitude:Fb.getAltitude(),altitudeAccuracy:Fb.getAltitudeAccuracy(),heading:Fb.getHeading(),speed:Fb.getSpeed()};b.TriggerEvent(ISY.Events.EventTypes.GeolocationUpdated,d)}}var Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb=[],Nb=[],Ob=[],Pb=new ISY.MapImplementation.OL3.FeatureEditor(b),Qb=!1,Rb="",Sb="",Tb=3e3,Ub=0,Vb=function(a){if(void 0!==a){for(var b,c=0;c<Bb.length;c++)if(Bb[c]===a){b=Cb[c];break}return b}},Wb=function(a){if(void 0===a&&(a=lc()),1==a)return Bb[Bb.length-1];if(a==1/0)return void 0;for(var b=-1,c=0;c<Cb.length;c++)if(Cb[c]<a){b=c-1;break}return 0>b?Bb[Bb.length-1]:Bb[b]},Xb=function(){f.WindowResized(Ab)},Yb=function(a){if(0!==a.length&&(!Hb||Hb!==a)){Hb=a;for(var b={isyToken:Hb},c=0;c<Nb.length;c++){Nb[c].isyToken=Hb;var d,e=Nb[c],f=K(e),g=!1;switch(e.source){case ISY.Domain.SubLayer.SOURCES.wms:case ISY.Domain.SubLayer.SOURCES.wmts:case ISY.Domain.SubLayer.SOURCES.proxyWms:case ISY.Domain.SubLayer.SOURCES.proxyWmts:d=f.getSource();break;case ISY.Domain.SubLayer.SOURCES.vector:g=!0,d=new ISY.MapImplementation.OL3.Sources.Vector(e),""!==e.url&&J(e,d);break;case ISY.Domain.SubLayer.SOURCES.wfs:g=!0,d=new ISY.MapImplementation.OL3.Sources.Wfs(e,j,b)}d&&(g?f.setSource(d):d.updateParams(b))}}},Zb=function(){Hb=void 0;for(var a={isyToken:""},b=0;b<Nb.length;b++){Nb[b].isyToken=Hb;var c,d=Nb[b],e=K(d),f=!1;switch(d.source){case ISY.Domain.SubLayer.SOURCES.wms:case ISY.Domain.SubLayer.SOURCES.wmts:case ISY.Domain.SubLayer.SOURCES.proxyWms:case ISY.Domain.SubLayer.SOURCES.proxyWmts:c=e.getSource();break;case ISY.Domain.SubLayer.SOURCES.vector:f=!0,c=new ISY.MapImplementation.OL3.Sources.Vector(d),""!==d.url&&J(d,c);break;case ISY.Domain.SubLayer.SOURCES.wfs:f=!0,c=new ISY.MapImplementation.OL3.Sources.Wfs(d,j)}c&&(f?e.setSource(c):c.updateParams(a))}};Array.prototype.where=function(a){for(var b=[],c=0;c<this.length;c++)a(this[c])&&b.push(this[c]);return b};var $b=function(){if(void 0!==Ab){var a={layers:da()},b=Ab.getView(),c=b.getCenter(),d=b.getZoom();return d&&(a.zoom=d.toString()),c&&(a.lat=c[1].toFixed(2),a.lon=c[0].toFixed(2)),a}},_b=function(a){var b=K(a);if(b){var c=b.getSource().getExtent();Array.isArray(c)&&c[0]!=1/0&&Ab.getView().fit(c,Ab.getSize())}},ac=function(a){Ab.getView().fit(a,Ab.getSize())},bc=function(){var a,b=Ab.getView(),c=b.getCenter(),d=b.getZoom();return a={lon:c[0],lat:c[1],zoom:d}},cc=function(a){var b=Ab.getView();a.epsg&&(a=qb(a,hc())),b.setCenter([a.lon,a.lat]),a.zoom&&b.setZoom(a.zoom)},dc=function(){var a=Ab.getView();return a.getZoom()},ec=function(a){var b=Ab.getView();return b.setZoom(a)},fc=function(){var a=Ab.getView();return a.getRotation()},gc=function(a,b){var c=Ab.getView();b?c.rotate(a,b):c.setRotation(a)},hc=function(){var a=Ab.getView(),b=a.getProjection();return b.getCode()},ic=function(a,b){for(var c=[],d=ISY.MapImplementation.OL3.Sources.Vector(a.subLayers[0],Ab.getView().getProjection()),e=ol.proj.get(a.subLayers[0].coordinate_system),f=ol.proj.get(d.getProjection().getCode()),g=d.parser.readFeatures(b),h=0;h<g.length;h++){var i=g[h];i.getGeometry().transform(e,f),c.push(i)}return c},jc=function(){return Ab?Ab.getLayers().getArray().length:0},kc=function(a){return ol.extent.getCenter(a)},lc=function(){return Cb[Ab.getView().getZoom()]},mc=function(a){return void 0!==Ob[a.guid]?Ob[a.guid].GetStyleForLegend():void 0},nc=function(){return Ab.getView().calculateExtent(Ab.getSize())},oc=function(){return $b()},pc=function(){var a=Ab.getView(),b=a.getProjection();Fb=new ol.Geolocation({projection:b,tracking:!0,trackingOptions:{maximumAge:0}}),xb(99999),Qb=!0,Fb.on("change:position",zb),Fb.on("change:accuracy",zb)},qc=function(){var a=V(99999);null!==a&&(Ab.removeLayer(a),ca()),void 0!==Fb&&(Fb.un("change:position",zb),Fb.un("change:accuracy",zb),Fb=void 0)},rc=function(){return Rb},sc=function(a){Gb=a},tc=function(a,b,c){if(proj4.defs(a)&&proj4.defs(b)){var d=proj4(a,b);return d.forward(c)}},uc=function(a){var b=hc();if(proj4.defs(b)){var c=proj4(b);return c.forward(a)}},vc=function(a){var b=hc();if(proj4.defs(b)){var c=proj4(b);return c.inverse(a)}};return{InitMap:n,ChangeView:u,AddDataToLayer:v,RemoveDataFromLayer:w,ClearLayer:x,ShowLayer:z,ShowBaseLayer:B,HideLayer:C,GetLayerByName:X,SetLayerOpacity:R,SetLayerSaturation:S,SetLayerHue:T,SetLayerBrightness:P,SetLayerContrast:Q,MoveLayerToIndex:Y,GetLayerIndex:W,GetLegendStyles:A,RefreshLayer:ma,RefreshIsyLayer:la,RedrawMap:ia,RefreshMap:ja,RefreshLayerByGuid:ka,RenderSync:oa,ExportMap:ha,ActivateExport:fa,DeactivateExport:ga,ActivateInfoClick:pa,DeactivateInfoClick:qa,GetInfoUrl:ra,ShowHighlightedFeatures:sa,ClearHighlightedFeatures:ta,ShowInfoMarker:ua,SetHighlightStyle:wa,RemoveInfoMarker:va,ActivateBoxSelect:xa,DeactivateBoxSelect:ya,GetFeaturesInExtent:Ka,GetExtentForCoordinate:Ja,GetFeatureCollection:La,GetFeatureExtent:Qa,GetFeaturesInMap:Ma,GetLayerByFeature:Na,GetHoverStyle:Oa,GetLegendStyleFromLayer:mc,InitEdit:za,ActivateEditSelect:Da,DeactivateEditSelect:Ea,HandlePointSelect:Fa,UpdateFeature:Ga,InsertFeature:Ha,DeleteFeature:Ia,ActivateHoverInfo:Ra,DeactivateHoverInfo:Sa,ActivateMeasure:Ta,DeactivateMeasure:Ua,ActivateMeasureLine:Va,DeactivateMeasureLine:Wa,ActivateAddLayerFeature:Xa,DeactivateAddLayerFeature:Ya,ActivateAddFeatureGps:Za,AddCoordinatesGps:$a,DeactivateAddFeatureGps:_a,ActivateModifyFeature:ab,DeactivateModifyFeature:bb,ActivateDrawFeature:cb,DeactivateDrawFeature:db,ActivateOffline:fb,StartCaching:gb,StopCaching:hb,DeleteDatabase:ib,CacheDatabaseExist:jb,CalculateTileCount:kb,GetResource:lb,GetConfigResource:mb,GetLayerResource:ob,DeactivateOffline:pb,GetResourceFromJson:nb,TransformBox:rb,ConvertGmlToGeoJson:sb,ExtentToGeoJson:tb,AddZoom:ub,AddZoomSlider:vb,AddZoomToExtent:wb,ZoomToLayer:_b,FitExtent:ac,GetCenter:bc,SetCenter:cc,GetZoom:dc,SetZoom:ec,GetRotation:fc,SetRotation:gc,GetEpsgCode:hc,GetVectorLayers:ic,GetLayerCount:jc,GetCenterFromExtent:kc,GetScale:lc,SortLayerBySortIndex:Z,UpdateLayerSortIndex:ba,GetExtent:nc,GetUrlObject:oc,GetGeolocation:pc,RemoveGeolocation:qc,GetProxyHost:rc,SetTranslateOptions:sc,TransformCoordinates:tc,TransformFromGeographic:uc,TransformToGeographic:vc,DescribeFeature:Ca,RemoveIsyToken:Zb,SetIsyToken:Yb,ShowCustomMessage:na}},ISY.MapImplementation.OL3.Map.RENDERERS={canvas:"canvas",webgl:"webgl"};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Measure=function(a){function b(b){o=new ol.layer.Vector({map:b,source:new ol.source.Vector({useSpatialIndex:!1}),updateWhileAnimating:!0,updateWhileInteracting:!0});var g="Polygon",h=new ol.source.Vector;v=new ol.interaction.Draw({source:h,type:g});var i=new ISY.MapImplementation.OL3.Styles.Measure;w=new ol.layer.Vector({source:h,style:i.Styles()}),b.addInteraction(v),b.addLayer(w),f(b),e(b);var j;v.on("drawstart",function(b){q=b.feature;var e=q.getGeometry().getCoordinates()[0][0];m=new ol.Feature(new ol.geom.Circle(e,0)),o.getSource().addFeature(m);var f=b.coordinate;j=q.getGeometry().on("change",function(b){var e,g,h=b.target;if(h instanceof ol.geom.Polygon){e=B(h),f=h.getInteriorPoint().getCoordinates(),d(h);var i=c(h);null!==i&&(g=B(i))}else h instanceof ol.geom.LineString&&(e=A(h),f=h.getLastCoordinate());var j=h.getCoordinates()[0];2==j.length?t.innerHTML=g.string:t.innerHTML=e.string,a.TriggerEvent(ISY.Events.EventTypes.MeasureMouseMove,e),u.setPosition(f)})},this),v.on("drawend",function(){t.className="tooltip tooltip-static",u.setOffset([0,-7]),q=null,t=null,f(b),ol.Observable.unByKey(j)},this)}function c(a){var b=a.getCoordinates()[0];return 2==b.length?(m.getGeometry().setRadius(n),Math.PI*Math.pow(n,2)):(m.getGeometry().setRadius(0),null)}function d(a){return g(a.getCoordinates()[0])}function e(a){r&&null!==r.parentNode&&r.parentNode.removeChild(r),r=document.createElement("div"),r.className="tooltip hidden",s=new ol.Overlay({element:r,offset:[15,0],positioning:"center-left"}),a.addOverlay(s)}function f(a){t&&null!==t.parentNode&&t.parentNode.removeChild(t),t=document.createElement("div"),t.className="tooltip tooltip-measure",u=new ol.Overlay({element:t,offset:[0,-15],positioning:"bottom-center"}),a.addOverlay(u)}function g(a){var b=h(a);n=b,b=Math.round(100*b)/100;var c,d,e;return b>100?(e="km",d=Math.round(b/1e3*100)/100,c=d+" "+e):(e="m",d=Math.round(100*b)/100,c=d+" "+e),{string:c,unit:e,value:d}}function h(a){var b;if(a.length>0){var c=a[0].length,d=i(a);b=j(d,0,d.length,c)}return b}function i(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)b.push(d[e]);return b}function j(a,b,c,d){var e,f=a[b],g=a[b+1],h=0;for(e=b+d;c>e;e+=d){var i=a[e],j=a[e+1];h+=Math.sqrt((i-f)*(i-f)+(j-g)*(j-g)),f=i,g=j}return h}function k(a,c){x=!0,p=c.translate,a.on("pointermove",z),$(a.getViewport()).on("mouseout",function(){$(r).addClass("hidden")}),b(a)}function l(b){if(x){if(x=!1,void 0!==b){b.removeLayer(w),t.className="tooltip tooltip-static",u.setOffset([0,-7]),m.getGeometry().setRadius(0),t=null,b.removeInteraction(v),b.removeOverlay(o),b.removeOverlay(u),b.removeOverlay(s),r&&r.parentNode.removeChild(r),t&&t.parentNode.removeChild(t);for(var c=document.getElementsByClassName("tooltip tooltip-static");c.length>0;){var d=c[0];d.parentNode.removeChild(d)}}a.TriggerEvent(ISY.Events.EventTypes.MeasureEnd)}}var m,n,o,p,q,r,s,t,u,v,w,x=!1,y="Click to continue drawing the line",z=function(a){if(!a.dragging&&x){var b=p.start_measure;if(q){var c=q.getGeometry();c instanceof ol.geom.Polygon?b=p.continue_measure:c instanceof ol.geom.LineString&&(b=y)}r.innerHTML=b,s.setPosition(a.coordinate),$(r).removeClass("hidden")}},A=function(a){var b,c=Math.round(100*a.getLength())/100;return b=c>100?Math.round(c/1e3*100)/100+" km":Math.round(100*c)/100+" m"},B=function(a){var b,c,d,e;return e=void 0===a.getArea?a:a.getArea(),e>1e5?(c="km<sup>2</sup>",d=Math.round(e/1e6*100)/100,b=d+" "+c):1e5>e&&e>1e3?(c="da",d=Math.round(e/1e3*100)/100,b=d+" "+c):(c="m<sup>2</sup>",d=Math.round(100*e)/100,b=d+" "+c),{string:b,unit:c,value:d,order:2}};return{Activate:k,Deactivate:l}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.MeasureLine=function(a){function b(b){var e="LineString",f=new ol.source.Vector;m=new ol.interaction.Draw({source:f,type:e});var g=new ISY.MapImplementation.OL3.Styles.Measure;n=new ol.layer.Vector({source:f,style:g.Styles()}),b.addInteraction(m),b.addLayer(n),d(b),c(b);var i;m.on("drawstart",function(b){h=b.feature;var c=b.coordinate;i=h.getGeometry().on("change",function(b){var d,e=b.target;e instanceof ol.geom.Polygon?(d=s(e),c=e.getInteriorPoint().getCoordinates()):e instanceof ol.geom.LineString&&(d=r(e),c=e.getLastCoordinate()),k.innerHTML=d.string,a.TriggerEvent(ISY.Events.EventTypes.MeasureMouseMove,d),l.setPosition(c)})},this),m.on("drawend",function(){k.className="tooltip tooltip-static",l.setOffset([0,-7]),h=null,k=null,d(b),ol.Observable.unByKey(i)},this)}function c(a){i&&null!==i.parentNode&&i.parentNode.removeChild(i),i=document.createElement("div"),i.className="tooltip hidden",j=new ol.Overlay({element:i,offset:[15,0],positioning:"center-left"}),a.addOverlay(j)}function d(a){k&&null!==k.parentNode&&k.parentNode.removeChild(k),k=document.createElement("div"),k.className="tooltip tooltip-measure",l=new ol.Overlay({element:k,offset:[0,-15],positioning:"bottom-center"}),a.addOverlay(l)}function e(a,c){o=!0,g=c.translate,a.on("pointermove",q),$(a.getViewport()).on("mouseout",function(){$(i).addClass("hidden")}),b(a)}function f(b){if(o){if(o=!1,void 0!==b){b.removeLayer(n),k.className="tooltip tooltip-static",l.setOffset([0,-7]),k=null,b.removeInteraction(m),b.removeOverlay(l),b.removeOverlay(j),i&&i.parentNode.removeChild(i),k&&k.parentNode.removeChild(k);for(var c=document.getElementsByClassName("tooltip tooltip-static");c.length>0;){var d=c[0];d.parentNode.removeChild(d)}}a.TriggerEvent(ISY.Events.EventTypes.MeasureEnd)}}var g,h,i,j,k,l,m,n,o=!1,p="Click to continue drawing the polygon",q=function(a){if(!a.dragging&&o){var b=g.start_measure_line;if(h){var c=h.getGeometry();c instanceof ol.geom.Polygon?b=p:c instanceof ol.geom.LineString&&(b=g.continue_measure_line)}i.innerHTML=b,j.setPosition(a.coordinate),$(i).removeClass("hidden")}},r=function(a){var b,c,d,e=Math.round(100*a.getLength())/100;return e>1e3?(c="km",d=Math.round(e/1e3*100)/100,b=d+" "+c):(c="m",d=Math.round(100*e)/100,b=d+" "+c),{string:b,unit:c,value:d,order:1}},s=function(a){var b,c=a.getArea();return b=c>1e4?Math.round(c/1e6*100)/100+" km<sup>2</sup>":Math.round(100*c)/100+" m<sup>2</sup>"};return{Activate:e,Deactivate:f}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.ModifyFeature=function(a){function b(b){"Line"===i&&(i="LineString");var e=new ol.Collection(j);o=new ol.interaction.Modify({features:e,deleteCondition:function(a){return ol.events.condition.shiftKeyOnly(a)&&ol.events.condition.singleClick(a)}}),b.addInteraction(o),c(b),d(b);var f;o.on("modifyend",function(b){l=null,ol.Observable.unByKey(f),l=b.features.getArray()[0],a.TriggerEvent(ISY.Events.EventTypes.ModifyFeatureEnd,l)},this)}function c(a){var b=new ol.Collection(k);p=new ol.interaction.Snap({features:b}),a.addInteraction(p)}function d(a){m&&null!==m.parentNode&&m.parentNode.removeChild(m),m=document.createElement("div"),m.className="tooltip hidden",n=new ol.Overlay({element:m,offset:[15,0],positioning:"center-left"}),a.addOverlay(n)}function e(a,c){if(q=!0,h=c.translate,j=[],Array.isArray(c.features))for(var d=0;d<c.features.length;d++)j.push(c.features[d]);else j.push(c.features);k=c.snappingFeatures,a.on("pointermove",r),$(a.getViewport()).on("mouseout",function(){$(m).addClass("hidden")}),b(a)}function f(a){a.removeOverlay(n),null!==m&&null!==m.parentNode&&m.parentNode.removeChild(m);for(var b=document.getElementsByClassName("tooltip tooltip-static");b.length>0;){var c=b[0];c.parentNode.removeChild(c)}}function g(a){q&&(q=!1,l=null,void 0!==a&&(a.removeInteraction(o),a.removeInteraction(p),f(a)))}var h,i,j,k,l,m,n,o,p,q=!1,r=function(a){if(q){var b=h.start_modify;void 0!==m&&(m.innerHTML=b,n.setPosition(a.coordinate),$(m).removeClass("hidden"))}};return{Activate:e,Deactivate:g}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Offline=function(){var a,b,c,d,e,f,g,h,i,j,k,l=!1,m="config",n="map",o={},p="pouchtiles:",q=0,r=!0,s=!0,t=[],u=[],v=0,w=[],x=0,y=[],z=function(a,b){h=a,i=h.getView(),j||(j=b),G(m),J("settings")},A=function(){return l},B=function(){return k},C=function(){l||(l=!0,d=i.getCenter(),y.length=0,g=new ol.layer.Vector({source:new ol.source.Vector({features:y})}),h.addLayer(g),G(n),D())},D=function(){q=0;for(var a=h.getLayers().getArray(),b=0;b<a.length;b++){console.log("checking "+a[b].typename+" for offline activation");var c=a[b].get("config");if(c)if("wms"===c.source.toLowerCase()||"proxywms"===c.source.toLowerCase())H(a[b]),console.log("wms "+a[b].typename+" activated offline");else if("wfs"===c.source.toLowerCase()){var d=a[b].getSource();d&&(d.clear(),d.set("caching",!0),console.log("wfs "+a[b].typename+" activated offline"))}}},E=function(){void 0!==h&&void 0!==g&&(y.length=0,g.getSource().clear(),h.removeLayer(g)),l&&(l=!1,F())},F=function(){for(var a=h.getLayers().getArray(),b=0;b<a.length;b++){var c=a[b].get("config");if(c)if("wms"===c.source.toLowerCase()||"proxywms"===c.source.toLowerCase())I(a[b]);else if("wfs"===c.source.toLowerCase()){var d=a[b].getSource();d&&d.set("caching",!1)}}},G=function(a){return o[a]||(o[a]=new PouchDB(p+a,{size:50})),o[a]},H=function(a){var b=a.getSource();X(b,aa),b.on("tileloadstart",function(){++q,r=!1}),b.on("tileloadend",function(){V()}),b.on("tileloaderror",function(){V()})},I=function(a){var b=a.getSource();X(b,void 0),b.un("tileloadstart",function(){}),b.un("tileloadend",function(){}),b.un("tileloaderror",function(){})},J=function(a){return k=!1,o[m]&&o[m].get(a).then(function(a){a.hasOwnProperty("title")&&"cacheCreated"===a.title&&(k=a.isCacheCreated,j.TriggerEvent(ISY.Events.EventTypes.StatusPouchDbChanged,k))}),k},K=function(a){o[m]&&o[m].get("settings").then(function(b){return k=a,j.TriggerEvent(ISY.Events.EventTypes.StatusPouchDbChanged,k),o[m].put({_id:"settings",_rev:b._rev,title:"cacheCreated",isCacheCreated:a})}).then(function(a){ma(a)})["catch"](function(b){b&&"not_found"==b.name?(k=a,j.TriggerEvent(ISY.Events.EventTypes.StatusPouchDbChanged,k),o[m].put({_id:"settings",title:"cacheCreated",isCacheCreated:a}).then(function(a){console.log(a)})["catch"](function(a){console.log(a)})):ma(b)})},L=function(a,b,c){var d=b?m:n;G(d),o[d].getAttachment(a,"resource").then(function(a){blobUtil.blobToBinaryString(a).then(function(a){resource=JSON.parse(a),c(resource,!0)})["catch"](function(a){console.log("_getOfflineResource ny feil: "+a),c(void 0,!1)})})["catch"](function(a){console.log(a),c(void 0,!1)})},M=function(a,b,c,d,e){navigator.onLine&&A()&&$.ajax({url:c}).done(function(f){if("object"==typeof f&&0!==f.firstChild.childElementCount){e&&e(f);var g=new XMLSerializer,h="text/plain";G(d),o[d].putAttachment(a,b,btoa(g.serializeToString(f)),h).then(function(){console.log(a+" added wfs "+b+" to cache!")})["catch"](function(e){console.log(a+" add wfs "+b+" failed! "+e),409===e.status&&(console.log("Retry:"+a+" add wfs "+b),O(a,b,c,d))})}})},N=function(a,b,c,d,e,f){navigator.onLine&&$.ajax({url:c}).done(function(c){if("object"==typeof c&&0!==c.firstChild.childElementCount){f&&f(c);var g=new XMLSerializer,h="text/plain";G(d),o[d].putAttachment(a,b,e,btoa(g.serializeToString(c)),h).then(function(){console.log(a+" added wfs "+b+" to cache!")})["catch"](function(c){console.log(a+" add wfs "+b+" failed! "+c)})}})},O=function(a,b,c,d){S(a,b,c,d)},P=function(a,b,c){U(a,b,c,!1)},Q=function(a,b,c){U(a,b,c,!0)},R=function(a,b,c){T(a,b,c,!1)},S=function(a,b,c,d){var e=n;G(e),o[e].get(a).then(function(f){o[e].getAttachment(a,b,function(g,h){g&&"not_found"==g.error||!h?N(a,b,c,e,f._rev,d):blobUtil.blobToBase64String(h).then(function(c){d&&d($.parseXML(atob(c))),console.log(a+" retrieved "+b+" wfs from cache!")})["catch"](function(c){console.log(a+" retrieve "+b+" wfs failed! "+c)})})})["catch"](function(d){console.log("getLayerResource ny feil: "+d),404===d.status&&M(a,b,c,e)})},T=function(a,b,c,d){var e,f,g,h=d?m:n;if(G(h),l)return void L(a,d,c);try{$.ajax({type:"GET",url:a,async:!1}).done(function(a){g=!0,e=a,f=btoa(JSON.stringify(a))}).error(function(){g=!1,L(a,d,c)})}catch(i){return g=!1,void L(a,d,c)}g&&(o[h].get(a).then(function(b){o[h].put({_id:a,_rev:b._rev,_attachments:{resource:{content_type:"text/plain",data:f}}})["catch"](function(a){console.log("ny feil: "+a)})}).then(function(){})["catch"](function(b){b&&"not_found"==b.name?o[h].put({_id:a,_attachments:{resource:{content_type:"text/plain",data:f}}})["catch"](function(a){console.log(a)}):ma(b)}),c(e,!1))},U=function(a,b,c,d){var e,f,g;G(d?m:n);var h=d?m:n;if(l)return void L(a,d,c);try{if(e=$.ajax({type:"GET",url:a,async:!1}).responseText,!e)return void L(a,d,c);f="application/json"===b.toLowerCase()?xml2json.parser(e):e,g=btoa(JSON.stringify(f))}catch(i){return L(a,d,c),void c(f,!1)}G(h),o[h].get(a).then(function(b){o[h].put({_id:a,_rev:b._rev,_attachments:{resource:{content_type:"text/plain",data:g}}})["catch"](function(a){console.log("ny feil: "+a)})}).then(function(){})["catch"](function(b){b&&"not_found"==b.name?o[h].put({_id:a,_attachments:{resource:{content_type:"text/plain",data:g}}})["catch"](function(a){console.log(a),c(f,!1)}):ma(b)}),c(f,!1)},V=function(){--q,0>=q&&(r=!0,s||W())},W=function(){var a=x;if(w[a]>=t[a]*u[a]){if(a>=w.length-1)return s=!0,E(),i.setZoom(c),i.setCenter(d),h.removeLayer(g),void j.TriggerEvent(ISY.Events.EventTypes.CachingEnd,fa());a=++x}if(j){j.TriggerEvent(ISY.Events.EventTypes.CachingProgress,fa()),i.getZoom()!=c+a&&i.setZoom(c+a);var b,k;if(1===u[a])b=e[0]+(f[0]-e[0])/2,k=f[1]+(e[1]-f[1])/2,i.setCenter([b,k]),w[a]=1/0;else{var l=Math.floor(w[a]/u[a])%(u[a]-(u[a]-t[a])),m=w[a]%u[a];b=e[0]+l*(f[0]-e[0])/(t[a]-1),k=e[1]+m*(f[1]-e[1])/(u[a]-1),i.setCenter([b,k]),ka([b,k]),w[a]++}setTimeout(function(){r&&!s&&W()},100)}},X=function(a,b){if(a)if(b){var c=a.getTileLoadFunction();a.setTileLoadFunction(b),a.set("onlineTLF",c)}else{var d=a.get("onlineTLF");"function"==typeof d&&a.setTileLoadFunction(d)}},Y=function(a,b,c,d){G(n),o[n].get(a).then(function(e){o[n].getAttachment(a,b).then(function(f){f?(d.getImage().src=window.URL.createObjectURL(f),ma(a+" wms "+b+" retrieved from cache!")):(_(a,b,c,e._rev),d.getImage().src=c)})["catch"](function(a){console.log("_wmsAddOrUpdatePouchAttachment - Ny feil: "+a)})})["catch"](function(e){404===e.status&&(Z(a,b,c,d),d.getImage().src=c)})},Z=function(a,b,c,d){G(n),blobUtil.imgSrcToBlob(c,"image/jpeg","Anonymous").then(function(e){o[n].putAttachment(a,b,e,"image/png").then(function(){ma(a+" wms added to cache!")})["catch"](function(e){console.log(a+" add wms "+b+" failed! "+e),409===e.status&&(console.log("Retry:"+a+" add wms "+b),Y(a,b,c,d))})})["catch"](function(a){console.log("ny feil: "+a)})},_=function(a,b,c,d){G(n),blobUtil.imgSrcToBlob(c,"image/jpeg","Anonymous").then(function(c){o[n].putAttachment(a,b,d,c,"image/png").then(function(){ma(a+" wms added to cache!")})["catch"](function(b){ma(a+" add wms failed! "+b)})})["catch"](function(e){console.log(a+" add wms "+b+" failed! "+e),409===e.status&&(console.log("Retry:"+a+" add wms "+b),_(a,b,c,d))})},aa=function(a,b){var c="LAYERS=",d=b.substr(b.search(c,"i")),e=d.substr(c.length,d.indexOf("&")-c.length);e||(e="layer");var f=this.getTileCoord().join("-"),g=e+".png";Y(f,g,b,a)},ba=function(a,b,c,d){ea(a,b,c,d)},ca=function(){s=!0,j.TriggerEvent(ISY.Events.EventTypes.CachingEnd,fa()),E(),i.setZoom(c),i.setCenter(d),h.removeLayer(g)},da=function(a,b,c){var d=0;if(void 0!==h){var g=c,j=i.getResolution();e=[g[0],g[3]],f=[g[2],g[1]];var k=b-a,l=i.getZoom();l>a&&(j*=Math.pow(2,l-a));for(var m=0;k>m;m++)d+=Math.abs(Math.ceil((f[0]-e[0])/j*Math.pow(2,m+1)/256/2))*Math.abs(Math.ceil((e[1]-f[1])/j*Math.pow(2,m+1)/256/2))}return d},ea=function(d,g,h,k){C(),j=k;var l=i.getZoom(),m=i.getResolution(),n=l-d;n>0&&(m*=Math.pow(2,n)),v=g-d,i.setZoom(d);var o=h;e=[o[0],o[3]],f=[o[2],o[1]],la(e,f),c=i.getZoom(),s=!1,K(!0);var p=(o[2]-o[0])/i.getResolution(),q=(o[3]-o[1])/i.getResolution();a=Math.abs(Math.ceil((f[0]-e[0])/m*Math.pow(2,v)/p)),b=Math.abs(Math.ceil((e[1]-f[1])/m*Math.pow(2,v)/q)),t.length=0,u.length=0,w.length=0;for(var r=0,x=0;v>x;x++)w[x]=0,n>0?(t[x]=1,u[x]=1,n--):(t[x]=Math.abs(Math.ceil((f[0]-e[0])/m*Math.pow(2,r+1)/p)),u[x]=Math.abs(Math.ceil((e[1]-f[1])/m*Math.pow(2,r+1)/q)),r++);a>1&&b>1?(j.TriggerEvent(ISY.Events.EventTypes.CachingStart,ga()),W()):ma("Area too small! Increase area or number of zoom levels!")},fa=function(){var a=0;if(w.length>0&&w.length>0)for(var b=0;v>b;b++)w[b]===1/0?a++:a+=w[b];return a},ga=function(){var a=0;if(t.length>0&&u.length>0)for(var b=0;v>b;b++)a+=t[b]*u[b];return a},ha=function(a,b,c){K(!1),G(n),o[n]&&o[n].destroy(p+n,function(d,e){return d?void ma("Database destroy error: "+d+" "+e):(ma("Deleted "+p+n+" database."),o[n]=void 0,void(a&&a(b,c)))})},ia=function(){var a=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0,0,0,0.3)",width:1}),fill:new ol.style.Fill({color:"rgba(160,0,0,0.9)"})});return a},ja=function(){var a=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(160,0,0,0.7)",width:2})});return a},ka=function(a){var b=g.getSource(),c=new ol.Feature({geometry:new ol.geom.Circle(a,5*i.getResolution())});return c.setStyle(ia()),y[y.length]=c,y[y.length-1][0]="circle",b.addFeature(c),c},la=function(a,b){var c=g.getSource();p1=a,p2=[a[0],b[1]],p3=b,p4=[b[0],a[1]];var d=[p1,p2,p3,p4,p1],e=new ol.Feature({geometry:new ol.geom.LineString(d)});return e.setStyle(ja()),y[y.length]=e,y[y.length-1][0]="square",c.addFeature(e),e},ma=function(a){a&&console&&console.log(a)};return{Init:z,IsActive:A,CacheDatabaseExist:B,Activate:C,Deactivate:E,StartCaching:ba,StopCaching:ca,CalculateTileCount:da,GetResource:P,GetConfigResource:Q,GetLayerResource:S,DeleteDatabase:ha,GetDatabase:G,GetResourceFromJson:R}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.ProgressBar=function(a){function b(b){e=b,a.RegisterEvent(ISY.Events.EventTypes.ChangeLayers,c)}function c(){var a=document.getElementById("progressbar");void 0!==a&&null!==a&&(f=new d(a),e.getLayers().forEach(function(a){var b=a.getSource();if(b){var c=b.get("type");switch(c){case"ol.source.Vector":b.on("vectorloadstart",function(){f.addLoading()}),b.on("vectorloadend",function(){f.addLoaded()});break;case"ol.source.ImageWMS":b.on("imageloadstart",function(){f.addLoading()}),b.on("imageloadend",function(){f.addLoaded()}),b.on("imageloaderror",function(){f.addLoaded()});break;case"ol.source.TileWMS":b.on("tileloadstart",function(){f.addLoading()}),b.on("tileloadend",function(){f.addLoaded()}),b.on("tileloaderror",function(){f.addLoaded()});break;case void 0:break;default:console.log(b.get("type"))}}}))}function d(a){this.el=a,this.loading=0,this.loaded=0}var e,f;return d.prototype.addLoading=function(){0===this.loading&&this.show(),++this.loading,this.update()},d.prototype.addLoaded=function(){var a=this;++a.loaded,a.loaded>a.loading&&(a.loaded=a.loading),a.update()},d.prototype.update=function(){var a=(this.loaded/this.loading*100).toFixed(1)+"%";if(this.el.style.width=a,this.loading===this.loaded){this.loading=0,this.loaded=0;var b=this;setTimeout(function(){b.hide()},500)}},d.prototype.show=function(){this.el.style.visibility="visible"},d.prototype.hide=function(){this.loading===this.loaded&&(this.el.style.visibility="hidden",this.el.style.width=0)},{Init:b}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Utilities=function(){function a(a){var b=new ol.format.WMSCapabilities,c=b.read(a),d=new ol.format.GML,e=d.readFeatures(c),f=new ol.format.GeoJSON;return f.writeFeatures(e)}function b(a,b){var c=new ol.geom.Point([a,b]),d=new ol.Feature;d.setGeometry(c);var e=new ol.format.GeoJSON;return e.writeFeature(d)}return{ConvertGmlToGeoJson:a,ExtentToGeoJson:b}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},
ISY.MapImplementation.OL3.Sources.CustomMessageHandler=function(a,b){function c(c,d){h=c,d&&d.length>0&&(k=d),j=b,a.RegisterEvent(ISY.Events.EventTypes.ChangeLayers,f)}function d(a){void 0!==a&&(k=a),f()}function e(a){i&&i.showMessage(a)}function f(){var a=document.getElementById("messagecontainer");void 0!==a&&null!==a&&(i=new g(a),h&&h.getLayers().forEach(function(a){var b=j(a),c=a.getSource();if(c){var d=c.get("type");switch(d){case"ol.source.ImageWMS":c.on("imageloaderror",function(a){i.showMessage(b.title,a)});break;case"ol.source.TileWMS":c.on("tileloaderror",function(a){i.showMessage(b.title,a)})}}}))}function g(a){this.el=a,this.messages=[],this.looping=!1,this.visible=!1}var h,i,j,k="Service down: ";return g.prototype.showMessage=function(a,b){var c=this;if(a=c.getResponse(a,b),0===c.messages.length)c.messages.push(a);else{var d=!0;c.messages.forEach(function(b){d&&b===a&&(d=!1)}),d&&c.messages.push(a)}c.show()},g.prototype.getResponse=function(a,b){try{var c=b.tile.getImage();if(c&&c.src&&(c.src.toLowerCase().indexOf("&gkt=")<0||c.src.toLowerCase().indexOf("?gkt=")<0)){var d=$.ajax({type:"GET",url:c.src,async:!1}).responseText,e=xml2json.parser(d);if(e&&e.serviceexceptionreport&&e.serviceexceptionreport.serviceexception){var f=e.serviceexceptionreport.serviceexception.split("\n");return a+"<br>"+f[2]+" "+f[3].substr(0,f[3].indexOf(" Token:"))}}}catch(g){}return a},g.prototype.show=function(){var a=this;a.visible||(a.visible=!0,a.el.innerHTML="",a.el.style.opacity=1,a.el.style.visibility="visible",a.looping||(a.looping=!0,a.loopMessages()))},g.prototype.hide=function(){var a=this;a.visible&&(a.looping=!1,a.visible=!1,a.el.style.opacity=0,setTimeout(function(){a.el.style.visibility="hidden"},2e3))},g.prototype.loopMessages=function(a){void 0===a&&(a=this),a.messages.length>0?(a.el.innerHTML=k+a.messages.pop(),setTimeout(function(){a.loopMessages(a)},1e3)):a.hide()},{Init:c,InitMessage:d,ShowCustomMessage:e}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.Sources.Vector=function(a){var b,c=ol.proj.get(a.coordinate_system);switch(a.format){case ISY.Domain.SubLayer.FORMATS.geoJson:b=new ol.source.Vector({format:new ol.format.GeoJSON,projection:c}),b.set("type","ol.source.Vector")}return b};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.Sources.Wfs=function(a,b,c,d,e){var f;if(a.tiled){var g=[];g[0]=21664;for(var h=1;18>h;h++)g[h]=g[h-1]/2;f=ol.loadingstrategy.tile(new ol.tilegrid.TileGrid({origin:[0,0,0],resolutions:g}))}else f=ol.loadingstrategy.bbox;var i=ol.proj.get(a.coordinate_system),j=function(b){l.dispatchEvent("vectorloadend");var c;if("undefined"==typeof l.format){var f;switch(a.version){case"1.0.0":f=new ol.format.GML2;break;case"1.1.0":f=new ol.format.GML3;break;case"2.0.0":f=new ol.format.GML3;break;default:f=new ol.format.GML}a.srs_dimension&&a.srs_dimension.length>0?(c=b.firstChild.firstElementChild.firstElementChild.namespaceURI,l.format=new ol.format.WFS({featureType:b.firstChild.firstElementChild.firstElementChild.localName,featureNS:c,gmlFormat:f})):(c=b.firstChild.namespaceURI,l.format=new ol.format.WFS({featureType:a.name,featureNS:c,gmlFormat:f}))}if("3"===a.srs_dimension&&(c=b.firstChild.firstElementChild.firstElementChild.namespaceURI,"gml:featurecollection"===b.firstChild.nodeName.toLowerCase()))for(var g=0;g<b.firstChild.childNodes.length;g++){var h=b.firstChild.childNodes.item(g);if("gml:featuremember"===h.nodeName.toLowerCase())for(var i=0;i<h.childNodes.length;i++){var j=h.childNodes.item(i);if(j.nodeName.toLowerCase()===a.name.toLowerCase())for(var k=0;k<j.childNodes.length;k++)for(var m=j.childNodes.item(k),n=0;n<m.childNodes.length;n++){var o=m.childNodes.item(n).nodeName;if("gml:linestring"===o.toLowerCase()||"gml:point"===o.toLowerCase()){var p=document.createAttribute("srsDimension");p.value=a.srs_dimension,m.firstElementChild.attributes.setNamedItem(p)}}}}var q=l.format.readFeatures(b);q&&q.length>0&&(q.forEach(function(b){b.set("layerguid",a.id)}),l.addFeatures(q)),q.length>0&&(a.geometryName=q[0].getGeometryName()),a.featureNS=c,d&&e&&e.TriggerEvent(ISY.Events.EventTypes.RefreshSourceDone,d)},k=function(d){l.dispatchEvent("vectorloadstart");var e=a.url;if(Array.isArray(a.url)&&(e=a.url[0]),e.toLowerCase().indexOf("service=wfs")<0&&(e+="service=WFS&"),e+="request=GetFeature&version="+a.version+"&typename="+a.name+"&srsname="+a.coordinate_system+"&bbox="+d.join(","),c)for(var f in c)e+="&"+f+"="+c[f];var g=l.get("caching");if(g||b.IsActive()){var h=d[0]+"-"+d[1];b.GetLayerResource(h,a.name,e,j)}else $.ajax({url:e}).done(function(a){"object"==typeof a&&0!==a.firstChild.childElementCount&&j(a)})},l=new ol.source.Vector({loader:k,strategy:f,projection:i});return l.set("type","ol.source.Vector"),l};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.Sources.WfsT=function(a,b,c,d,e,f){function g(a,b){if(void 0===u.format&&void 0===b)return f.TriggerEvent(ISY.Events.EventTypes.TransactionInsertEnd,!1),!1;void 0!==b&&(u=b);var c=u.format.writeTransaction([a],null,null,{gmlOptions:{srsName:t},featureNS:s,featureType:r}),d=v.serializeToString(c);d=d.replace(/geometry/g,a.getGeometryName()),d=d.replace(/&/g,"&amp;");var e="Error inserting feature: ",g=!0;if($.ajax({type:"POST",url:q,data:d,async:!1,success:function(b){var c=l(b);if(void 0===c)g=!1,e+="Response parse error.";else if("string"==typeof c)g=!1,e+=c;else if(void 0===c.transactionSummary)g=!1;else if(c&&1===c.transactionSummary.totalInserted){var d=c.insertIds[0];a.setId(d);var h=n(d);a.set("lokalId",h),u.addFeature(a)}else g=!1,e+="Feature not inserted.";f.TriggerEvent(ISY.Events.EventTypes.TransactionInsertEnd,g)},error:function(a){var b=a?a.status+" "+a.statusText:"";"200 parsererror"===b&&(b="Response parse error."),g=!1,e+=b,f.TriggerEvent(ISY.Events.EventTypes.TransactionInsertEnd,g)}}),!g)throw new Error(e)}function h(a){if(void 0===u.format)return f.TriggerEvent(ISY.Events.EventTypes.TransactionUpdateEnd,!1),!1;var b=a.getId(),c=a.getProperties();delete c.bbox;var d=new ol.Feature(c);d.setId(b);var e,g,h=p(r);""!==h?(e=u.format.writeTransaction(null,[d],null,{gmlOptions:{srsName:t},featureNS:s,featureType:o(r),featurePrefix:h}),g=j(e),g=g.replace(/<Name>/g,"<Name>"+h+":")):(e=u.format.writeTransaction(null,[d],null,{gmlOptions:{srsName:t},featureNS:s,featureType:o(r)}),g=j(e)),g=g.replace('xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"','xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns="http://www.opengis.net/wfs"'),g=g.replace("Filter",'Filter xmlns="http://www.opengis.net/ogc"'),g=g.replace("Point",'Point xmlns="http://www.opengis.net/gml"'),g=g.replace("Polygon",'Polygon xmlns="http://www.opengis.net/gml"'),g=g.replace("LineString",'LineString xmlns="http://www.opengis.net/gml"'),g=g.replace(/&/g,"&amp;");var i="Error updating feature: ",k=!0;if($.ajax({type:"POST",url:q,data:g,success:function(a){var d=l(a);if(void 0===d)k=!1,i+="Response parse error.";else if("string"==typeof d)k=!1,i+=d;else if(void 0===d.transactionSummary)k=!1;else if(d&&void 0===d.transactionSummary.totalUpdated)k=!1,i+="Response parse error.";else if(d&&1!=d.transactionSummary.totalUpdated)k=!1,i+="Feature not updated.";else{var e=u.getFeatureById(b);void 0!==e&&e.setProperties(c)}f.TriggerEvent(ISY.Events.EventTypes.TransactionUpdateEnd,k)},error:function(a){var b=a?a.status+" "+a.statusText:"";"200 parsererror"===b&&(b="Response parse error."),k=!1,i+=b,f.TriggerEvent(ISY.Events.EventTypes.TransactionUpdateEnd,k)}}),!k)throw new Error(i)}function i(a){if(a.childElementCount>0)for(var b=0;b<a.childNodes.length;b++){if(w+="<"+a.childNodes[b].nodeName,a.childNodes[b].attributes.length>0)for(var c=0;c<a.childNodes[b].attributes.length;c++){var d=a.childNodes[b].attributes[c];w+=" "+d.name+'="'+d.value+'"'}a.childNodes[b].childNodes.length>0&&(w+=">"),a.childNodes[b].childElementCount>0?i(a.childNodes[b]):a.childNodes[b].childNodes.length>0?(w+=a.childNodes[b].childNodes[0].nodeValue,w+="</"+a.childNodes[b].nodeName+">"):w+="/>"}else{if(w+="<"+a.nodeName,a.attributes.length>0)for(var e=0;e<a.attributes.length;e++){var f=a.attributes[e];w+=" "+f.name+'="'+f.value+'"'}a.childNodes[0].childNodes.length>0?(w+=">",w+=a.childNodes[0].nodeValue,w+="</"+a.nodeName+">"):w+="/>"}w+="</"+a.nodeName+">"}function j(a){var b=a.getElementsByTagName("*"),c="",d=[],e=b[0].parentNode;c+="<"+e.nodeName,d.push(e.nodeName);for(var f=0;f<e.attributes.length;f++){var g=e.attributes[f];c+=" "+g.name+'="'+g.value+'"'}c+=">",c+="<"+b[0].nodeName,d.push(b[0].nodeName);for(var h=0;h<b[0].attributes.length;h++){var j=b[0].attributes[h];c+=" "+j.name+'="'+j.value+'"'}c+=">";for(var k=b[0],l=0;l<k.childElementCount;l++){if(c+="<"+k.childNodes[l].nodeName,k.childNodes[l].attributes.length>0)for(var m=0;m<k.childNodes[l].attributes.length;m++){var n=k.childNodes[l].attributes[m];c+=" "+n.name+'="'+n.value+'"'}c+=">",i(k.childNodes[l]),c+=w,w=""}for(var o=d.length-1;o>=0;o--)c+="</"+d[o]+">";return c}function k(a){if(void 0===u.format)return f.TriggerEvent(ISY.Events.EventTypes.TransactionRemoveEnd,!1),!1;var b=u.format.writeTransaction(null,null,[a],{featureNS:s,featureType:o(r)}),c=j(b);c=c.replace('xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"','xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns="http://www.opengis.net/wfs"'),c=c.replace("Filter",'Filter xmlns="http://www.opengis.net/ogc"');var d="Error deleting feature: ",e=!0;if($.ajax({type:"POST",url:q,data:c,success:function(a){var b=l(a);void 0===b?(e=!1,d+="Response parse error."):"string"==typeof b?(e=!1,d+=b):void 0===b.transactionSummary?e=!1:b&&1!=b.transactionSummary.totalDeleted&&(e=!1,d+="Feature not deleted."),f.TriggerEvent(ISY.Events.EventTypes.TransactionRemoveEnd,e)},error:function(a){var b=a?a.status+" "+a.statusText:"";"200 parsererror"===b&&(b="Response parse error."),e=!1,d+=b,f.TriggerEvent(ISY.Events.EventTypes.TransactionRemoveEnd,e)}}),!e)throw new Error(d)}function l(a){var b;return b=window.Document&&a instanceof Document&&a.documentElement&&"ExceptionReport"==a.documentElement.localName?a.getElementsByTagNameNS("http://www.opengis.net/ows","ExceptionText").item(0).textContent:u.format.readTransactionResponse(a)}function m(){return r}function n(a){var b=a.indexOf("{");if(-1!=b){var c=a.substr(b);return c}return""}function o(a){var b=a.indexOf(":");if(-1!=b){b++;var c=a.substr(b);return c}return a}function p(a){var b=a.indexOf(":");if(-1!=b){var c=a.substr(0,b);return c}return""}var q=a,r=b,s=c,t=d,u=e,v=new XMLSerializer,w="";return{InsertFeature:g,UpdateFeature:h,DeleteFeature:k,GetFeatureType:m}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.Sources.Wms=function(a,b){var c,d,e=function(a){var c="";if(b){for(var d in b)c.length>0&&(c+="&"),c+=d+"="+b[d];a+=a.indexOf("?")>0?"&":"?",a+=c}return a};if(Array.isArray(a.url)){d=a.url;for(var f=0;f<d.length;f++)d[f]=e(d[f])}else c=a.url,c=e(c);var g;return a.tiled?(g=new ol.source.TileWMS({params:{LAYERS:a.name,VERSION:"1.1.1",FORMAT:a.format},url:c,urls:d,crossOrigin:a.crossOrigin,transparent:a.transparent}),g.set("type","ol.source.TileWMS")):(void 0===c&&(c=d[d.length-1]),g=new ol.source.ImageWMS({params:{LAYERS:a.name,VERSION:"1.1.1",FORMAT:a.format},ratio:1,url:c,crossOrigin:a.crossOrigin,transparent:a.transparent}),g.set("type","ol.source.ImageWMS")),g};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Sources=ISY.MapImplementation.OL3.Sources||{},ISY.MapImplementation.OL3.Sources.Wmts=function(a,b){var c=new ol.proj.Projection({code:a.coordinate_system,extent:a.extent,units:a.extentUnits}),d=function(){var a="";if(b)for(var c in b)a+="&"+c+"="+b[c];return a},e=c.getExtent(),f=a.matrixPrefix?ol.extent.getWidth(e)/256:4096,g=new Array(a.numZoomLevels),h=new Array(a.numZoomLevels),i=a.matrixSet;(null===i||""===i||void 0===i)&&(i=a.matrixPrefix?a.coordinate_system:parseInt(a.coordinate_system.substr(a.coordinate_system.indexOf(":")+1),10));for(var j=0;j<a.numZoomLevels;++j)g[j]=f/Math.pow(2,j),h[j]=a.matrixPrefix?i+":"+j:h[j]=j;var k,l;if(Array.isArray(a.url)&&1!==a.url.length){l=a.url;for(var m=0;m<l.length;m++)l[m]+=d()}else k=a.url[0],k+=d();var n=new ol.source.WMTS({url:k,urls:l,layer:a.name,format:a.format,projection:c,matrixSet:i,crossOrigin:a.crossOrigin,tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(e),resolutions:g,matrixIds:h}),style:"default",wrapX:!0});n.set("type","ol.source.WMTS");var o=n.tileLoadFunction,p=function(a,b){for(var c=b.split("&"),d="",e=0;e<c.length;e++){var f=c[e].split("=");if(0===e){var g=f[0].indexOf("?");d=f[0].substr(0,g+1),d+=f[0].substr(g+1).toUpperCase()}else d+="&"+f[0].toUpperCase();d+="="+f[1]}o(a,d)};return n.tileLoadFunction=p,n};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Styles=ISY.MapImplementation.OL3.Styles||{},ISY.MapImplementation.OL3.Styles.Default=function(){var a=function(){var a=new ol.style.Fill({color:"rgba(255,0,0,0.8)"}),b=new ol.style.Stroke({color:"#3399CC",width:2.25}),c=[new ol.style.Style({image:new ol.style.Circle({fill:a,stroke:b,radius:8}),fill:a,stroke:b})];return c};return{Styles:a}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Styles=ISY.MapImplementation.OL3.Styles||{},ISY.MapImplementation.OL3.Styles.Json=function(a){function b(a,b,h){var j="object"==typeof b?b:JSON.parse(b),k=[];return i++,k.push(new ol.style.Style({fill:c(j),icon:d(j,h),image:e(j,h),stroke:f(j,h),text:g(a,j,h),zIndex:i})),k}function c(a){return a.fill?new ol.style.Fill(a.fill):void 0}function d(a){return a.icon?new ol.style.Icon(a.icon):void 0}function e(a,b){if(a.image)return new ol.style.Circle({radius:b?1.2*a.image.radius:a.image.radius,fill:c(a.image),stroke:f(a.image)});if(a.regularshape){var d=parseInt(a.regularshape.angle,10),e=parseInt(a.regularshape.rotation,10);return new ol.style.RegularShape({fill:c(a.regularshape),stroke:f(a.regularshape),radius:b?1.2*a.regularshape.radius:a.regularshape.radius,radius2:b?1.2*a.regularshape.radius2:a.regularshape.radius2,points:a.regularshape.points,rotation:e>0?Math.PI/e:0,angle:d>0?Math.PI/d:0})}}function f(a,b){return a.stroke?(b&&(a.stroke.width*=2),new ol.style.Stroke(a.stroke)):void 0}function g(a,b,d){return b.text?(d&&(b.text.scale&&(b.text.scale*=1.2),b.text.rotation&&(b.text.rotation*=-1)),b.text.text=h(a,b.text.text),b.text.fill=c(b.text),b.text.stroke=f(b.text),new ol.style.Text(b.text)):void 0}function h(a,b){if(b){var c=b.indexOf("{");if(0>c)return b;for(var d="";c>=0;){c>0&&(d+=b.substr(0,c),b=b.slice(c),c=b.indexOf("{"));var e=b.indexOf("}"),f=b.substr(c+1,e-c-1),g=a.get(f);g&&(d+=g),b=b.slice(e+1),c=b.indexOf("{")}return d+b}}var i=0,j=function(c){if(c){var d=c.getProperties();return d.style?void c.setStyle(b(c,d.style)):b(c,a)}},k=function(c){return c?b(c,a,!0):void 0};return{GetStyle:j,GetHoverStyle:k}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Styles=ISY.MapImplementation.OL3.Styles||{},ISY.MapImplementation.OL3.Styles.Measure=function(){var a=function(){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.8)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})},b=function(){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.5)"}),stroke:new ol.style.Stroke({color:"rgba(160, 0, 0, 0.5)",width:2}),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(160, 0, 0, 0.8)"}),stroke:new ol.style.Stroke({color:"rgba(255, 255, 255, 0.8)",width:2})})})};return{DrawStyles:b,Styles:a}};var ISY=ISY||{};ISY.MapImplementation=ISY.MapImplementation||{},ISY.MapImplementation.OL3=ISY.MapImplementation.OL3||{},ISY.MapImplementation.OL3.Styles=ISY.MapImplementation.OL3.Styles||{},ISY.MapImplementation.OL3.Styles.Sld=function(){var a,b=[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.6)"}),stroke:new ol.style.Stroke({color:"#319FD3",width:2}),image:new ol.style.Circle({radius:3,fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.6)"}),stroke:new ol.style.Stroke({color:"#319FD3",width:2})}),text:new ol.style.Text({font:"12px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})})],c={sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;e>d;++d)c.userStyles[d].layerName=c.name;Array.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c=this,d={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(a,d);var e,f=d.isDefault?d.isDefault:!1;this.multipleSymbolizers?(delete d.defaultsPerSymbolizer,e=new ol.style.Style(d)):$(d.rules).each(function(a,d){var g,h,i,j=d.symbolizer.Polygon,k=d.symbolizer.Point,l=d.symbolizer.Line,m=d.symbolizer.Text;if(j)j.fill&&(g=new ol.style.Fill({color:c.getColorValue(j.fillColor,j.fillOpacity)})),j.stroke&&void 0!==j.strokeColor&&void 0!==j.strokeWidth&&(h=new ol.style.Stroke({color:c.getColorValue(j.strokeColor,j.strokeOpacity),width:parseInt(j.strokeWidth.trim(),10),lineDash:j.strokeDashstyle?j.strokeDashstyle.split(" "):void 0}));else if(k){if(k.fill&&(g=new ol.style.Fill({color:c.getColorValue(k.fillColor,k.fillOpacity)})),k.stroke&&(void 0!==k.strokeColor||void 0!==k.strokeWidth)&&(h=new ol.style.Stroke({color:c.getColorValue(k.strokeColor,k.strokeOpacity),width:k.strokeWidth?parseInt(k.strokeWidth.trim(),10):void 0,lineDash:k.strokeDashstyle?k.strokeDashstyle.split(" "):void 0})),k.label&&(void 0===k.outlineColor&&(k.outlineColor="#ffffff"),void 0===k.outlineWidth&&(k.outlineWidth="3"),m=new ol.style.Text({textAlign:c.getAlignValue(k.labelAnchorPointX),textBaseline:c.getBaselineValue(k.labelAnchorPointY),font:c.getFontValue(k),text:k.label,fill:new ol.style.Fill({color:c.getColorValue(k.fontColor,k.fontOpacity)}),stroke:new ol.style.Stroke({color:k.outlineColor?c.getColorValue(k.outlineColor):c.getColorValue(k.fontColor,k.fontOpacity),width:k.outlineWidth?parseInt(k.outlineWidth,10):void 0}),offsetX:k.labelXOffset?parseInt(k.labelXOffset,10):void 0,offsetY:k.labelYOffset?parseInt(k.labelYOffset,10):void 0,rotation:k.rotation?parseFloat(k.rotation):void 0})),k.graphic)if(k.externalGraphic){var n=k.fillOpacity?parseFloat(k.fillOpacity):void 0;i=new ol.style.Icon({opacity:n,src:k.externalGraphic}),g=void 0,h=void 0}else switch(k.graphicName){case"circle":i=new ol.style.Circle({radius:parseInt(k.pointRadius,10),stroke:h,fill:g});break;case"cross":i=new ol.style.RegularShape({radius:parseInt(k.pointRadius,10),radius2:0,points:4,stroke:h,fill:g});break;case"star":i=new ol.style.RegularShape({radius:parseInt(k.pointRadius,10),radius2:parseInt(k.pointRadius,10)/3,points:5,stroke:h,fill:g});break;case"square":i=new ol.style.RegularShape({radius:parseInt(k.pointRadius,10),points:4,angle:Math.PI/4,stroke:h,fill:g});break;case"triangle":i=new ol.style.RegularShape({radius:parseInt(k.pointRadius,10),points:3,stroke:h,fill:g});break;case"x":i=new ol.style.RegularShape({radius:parseInt(k.pointRadius,10),radius2:0,points:4,angle:Math.PI/4,stroke:h,fill:g})}}else l&&(l.fill&&(g=new ol.style.Fill({color:c.getColorValue(l.fillColor,l.fillOpacity)})),l.stroke&&(h=new ol.style.Stroke({color:c.getColorValue(l.strokeColor,l.strokeOpacity),width:c.getStrokeWidth(l.strokeWidth),lineDash:c.getStrokeDashstyle(l.strokeDashstyle)})),l.graphic&&"circle"==l.graphicName&&(i=new ol.style.Circle({radius:parseInt(l.pointRadius,10),fill:g}),g=void 0));e=new ol.style.Style({fill:g,image:i,stroke:h}),b.userStyles.push({isDefault:f,style:e,rule:d}),m&&(e=new ol.style.Style({text:m}),b.userStyles.push({isDefault:f,style:e,rule:d}))})},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c),this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});var d={symbolizer:[]};d.symbolizer={fill:!1,stroke:!1,graphic:!1},this.readChildNodes(a,d),b.rules.push(d)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c),c.labelRotation=c.rotation,delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;1/3>=e?d="l":e>1/3&&2/3>e?d="c":e>=2/3&&(d="r"),1/3>=f?d+="b":f>1/3&&2/3>f?d+="m":f>=2/3&&(d+="t"),c.labelAlign=d,console.error("PointPlacement is not implemented")},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c),b.haloRadius=c.haloRadius,b.haloColor=c.fillColor,b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,b){b.geometry={},this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[],this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=c},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=c},Stroke:function(a,b){b.stroke=!0,this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0,this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];if(b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity")),d){var e=this.readers.ogc._expression.call(this,a);e&&(b[d]=e)}},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);for(var d,e,f=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],g=0,h=f.length;h>g;++g)d=f[g],e=c[d],void 0!==e&&(b[d]=e);if(void 0!==c.opacity&&(b.graphicOpacity=c.opacity),void 0!==c.size){var i=c.size/2;isNaN(i)?b.graphicWidth=c.size:b.pointRadius=c.size/2}void 0!==c.href&&(b.externalGraphic=c.href),void 0!==c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}},ogc:{_expression:function(a){for(var b,c="",d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 1:b=this.readNode(d),b.property?c+="${"+b.property+"}":void 0!==b.value&&(c+=b.value);break;case 3:case 4:c+=d.nodeValue}return c},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),c.fids.length>0?b.filter={fids:c.fids}:c.filters.length>0&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c={filters:["&&"]};this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c={filters:["||"]};this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c={filters:["!"]};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c={operator:"=="};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsEqualTo:function(a,b){var c={operator:"=="};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c={operator:"!="};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c={operator:"<"};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c={operator:">"};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c={operator:"<="};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c={operator:">="};this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c={operator:".."};this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=this.getChildValue(a)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=this.readers.ogc._expression.call(this,a)},UpperBoundary:function(a,b){b.upperBoundary=this.readers.ogc._expression.call(this,a)},PropertyIsNull:function(a,b){var c={operator:"NULL"};this.readChildNodes(a,c),b.filters.push(c)}}},d=function(c,d){if("undefined"==typeof c)return b;"string"==typeof c&&(c=ol.xml.parse(c)),a={namedLayers:[]},this.readChildNodes(c,a),b=[];var e={maxScaleDenominator:1,minScaleDenominator:1/0};return $(a.namedLayers[0].userStyles).each(function(a,c){var f=c.style;d&&f.setZIndex(d),b.push(f),c.rule&&(c.rule.maxScaleDenominator&&e.maxScaleDenominator<c.rule.maxScaleDenominator&&(e.maxScaleDenominator=c.rule.maxScaleDenominator),c.rule.minScaleDenominator&&e.minScaleDenominator>c.rule.minScaleDenominator&&(e.minScaleDenominator=c.rule.minScaleDenominator))}),1==e.maxScaleDenominator&&(e.maxScaleDenominator=void 0),e.minScaleDenominator==1/0&&(e.minScaleDenominator=void 0),e},e=function(a,b){if(void 0===b)return!1;if(void 0===a)return!1;var c,d,e=!1;if(c=b.get(a.property))switch(a.operator){case"==":switch(typeof c){case"string":d=a.value,e=c==d;break;case"number":d=parseInt(a.value,10),e=parseInt(c,10)==d}break;case">":d=parseInt(a.value,10),e=parseInt(c,10)>d;break;case"<":d=parseInt(a.value,10),e=parseInt(c,10)<d;break;case">=":d=parseInt(a.value,10),e=parseInt(c,10)>=d;break;case"<=":d=parseInt(a.value,10),e=parseInt(c,10)<=d;break;case"!=":switch(typeof c){case"string":d=a.value,e=c!=d;break;case"number":d=parseInt(a.value,10),e=parseInt(c,10)!=d}break;case"NULL":switch(typeof c){case"string":e=0===c.length;break;case"number":d=parseInt(a.value,10),e=parseInt(c,10)!=d}break;case"..":c=parseInt(c,10),e=c>=parseInt(a.lowerBoundary,10)&&c<=parseInt(a.upperBoundary,10)}else switch(a.operator){case"NULL":e=!0}return e},f=function(a,b){var c=a.get("isHidden");void 0===c&&a.set("isHidden",b)},g=function(a,b){if(void 0===b)return!1;if(void 0===a)return!0;if(void 0===a.filters)return e(a,b);if(a.filters.length<=1)return!0;var c,d=!1;switch(a.filters[0]){case"&&":for(c=1;c<a.filters.length&&(d=g(a.filters[c],b),d);c++);break;case"||":for(c=1;c<a.filters.length&&!(d=g(a.filters[c],b));c++);break;case"!":}return d},h=function(a,b){return j(a,b)},i=function(a,b){var c=j(a,b,!0);return void 0===c&&(c=j(a,b)),c},j=function(c,d,e){void 0===e&&(e=!1);var h,i,j,m=[];return a?($(a.namedLayers[0].userStyles).each(function(a,b){e&&!b.isDefault?g(b.rule.filter,c)&&l(b.rule,d)&&(h=b.style.getText(),h?(i=h.getText(),h=angular.copy(b.style),j=k(i,c),h.getText().setText(j)):m.push(b.style)):!e&&b.isDefault&&g(b.rule.filter,c)&&l(b.rule,d)&&(h=b.style.getText(),h?(i=h.getText(),h=angular.copy(b.style),j=k(i,c),h.getText().setText(j)):m.push(b.style))}),h&&m.push(h),m.length>0?m:void(e||f(c,!0))):b},k=function(a,b){return a.indexOf("${")>=0&&(a=a.slice(a.indexOf("${")+2),a.indexOf("}")>=0&&(a=a.slice(0,a.indexOf("}")))),b.get(a)},l=function(a,b){if(void 0===a)return!0;var c=a.maxScaleDenominator?a.maxScaleDenominator:1/0,d=a.minScaleDenominator?a.minScaleDenominator:1;return c>=b&&b>=d?!0:!1},m=function(){return a?$(a.namedLayers[0].userStyles):void 0};return{Sld:a,Styles:b,ParseSld:d,GetStyle:h,GetStyleForLegend:m,GetHoverStyle:i,defaultPrefix:"sld",namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},namespaceAlias:{"http://www.opengis.net/sld":"sld","http://www.opengis.net/ogc":"ogc","http://www.opengis.net/gml":"gml","http://www.w3.org/1999/xlink":"xlink","http://www.w3.org/2001/XMLSchema-instance":"xsi"},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},readChildNodes:function(a,b){b||(b={});for(var c,d=a.childNodes,e=0,f=d.length;f>e;++e)c=d[e],1==c.nodeType&&this.readNode(c,b);return b},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];
if(c){var d=a.localName||a.nodeName.split(":").pop(),e=c[d]||c["*"];e&&e.apply(this,[a,b])}return b},readers:c,cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f,g=a.attributes,h=0,i=g.length;i>h;++h)if(e=g[h],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else{var e=this.getAttributeNodeNS(a,b,c);e&&(d=e.nodeValue)}return d},pixelRatio:1,getStrokeDashstyle:function(a){if(a){a=a.split(" ");for(var b=0;b<a.length;b++)a[b]=parseInt(a[b],10)*this.pixelRatio;return a}return void 0},getStrokeWidth:function(a){return parseInt(a.trim(),10)*this.pixelRatio},getFontValue:function(a){var b=this,c="";return c=b.addFontValue(c,a.fontStyle),c=b.addFontValue(c,a.fontWeight),a.fontSize&&(a.fontSize.indexOf("px")<0?(c=b.addFontValue(c,a.fontSize),c+="px"):c=b.addFontValue(c,a.fontSize)),c=b.addFontValue(c,a.fontFamily),c.trim()},addFontValue:function(a,b){return void 0===b?a:(a.length>0&&(a+=" "),a+b)},getAlignValue:function(a){if(void 0===a)return"center";var b=parseFloat(a);return 0===b?"left":b>0&&1>b?"center":"right"},getBaselineValue:function(a){if(void 0===a)return"middle";var b=parseFloat(a);return 0===b?"bottom":b>0&&1>b?"middle":"top"},getColorValue:function(a,b){void 0===a&&(a="#000000");var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a.trim());if(c.length<4)return void 0;var d={r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16),a:b?parseFloat(b.trim()):1,getValue:function(){return[this.r,this.g,this.b,this.a]}};return d.getValue()},getGraphicFormat:function(a){var b;for(var c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=c;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,pointRadius:3,graphicName:"square"}}};var ISY=ISY||{};ISY.Repository=ISY.Repository||{},ISY.Repository.Category=function(a){var b={catId:"",name:"",parentId:"",subCategories:[],isOpen:!1};return $.extend({},b,a)};var ISY=ISY||{};ISY.Repository=ISY.Repository||{},ISY.Repository.ConfigRepository=function(a,b){function c(a){var b={numZoomLevels:18,newMaxRes:21664,center:[570130,7032300],zoom:4,extent:[-2e6,35e5,3545984,9045984],layers:[],proxyHost:"http://geoinnsyn.norconsultad.com/services/isy.gis.isyproxy/?",tools:[]};$.extend(b,a);for(var c=[],d=0;d<a.layers.length;d++)c.push(new ISY.Domain.Layer(a.layers[d]));return b.layers=c,new ISY.Repository.MapConfig(b)}function d(d){a.GetMapConfig(d,function(a){var d=c(a);b.TriggerEvent(ISY.Events.EventTypes.MapConfigLoaded,d)})}function e(a){b.TriggerEvent(ISY.Events.EventTypes.MapConfigLoaded,a)}return{GetMapConfig:d,GetMapConfigFromJson:e}};var ISY=ISY||{};ISY.Repository=ISY.Repository||{},ISY.Repository.MapConfig=function(a){var b={name:"",comment:"",useCategories:!0,categories:[],numZoomLevels:10,newMaxRes:21664,newMaxScale:8192e4,renderer:"canvas",center:[-1,1],zoom:5,layers:[],coordinate_system:"EPSG:32633",matrixSet:"EPSG:32633",extent:[-1,-1,-1,-1],extentUnits:"m",proxyHost:"",groups:[]};return $.extend({},b,a)};var ISY=ISY||{};ISY.Repository=ISY.Repository||{},ISY.Repository.StaticRepository=function(){function a(){return b}var b=new ISY.Repository.MapConfig({numZoomLevels:18,newMaxRes:21664,renderer:ISY.MapImplementation.OL3.Map.RENDERERS.canvas,center:[570130,7032300],zoom:4,coordinate_system:"EPSG:32633",extent:[-2e6,35e5,3545984,9045984],extentunits:"m",proxyHost:"",layers:[{id:"1992",isBaseLayer:!0,subLayers:[{source:"WMS",url:["http://opencache.statkart.no/gatekeeper/gk/gk.open?LAYERS=norges_grunnkart"],gatekeeper:!0,name:"norges_grunnkart",format:"image/png",coordinate_system:"EPSG:32632",id:"1992",tiled:!0}],visibleOnLoad:!0},{id:"8001",isBaseLayer:!1,subLayers:[{source:"WFS",url:["https://kart5.nois.no/trondheim_neste/wfs/default.asp?conname=Regplan&"],name:"RpOmrde",version:"1.0.0",coordinate_system:"EPSG:32632",id:"8001",tiled:!1,style:"http://geoinnsyn.norconsultad.com/Services/ISY.GIS.IsyGeoinnsynConfig/api/v1/style?application=GeoInnsyn&name=RegplanVedtatt"}],visibleOnLoad:!0},{id:"8002",isBaseLayer:!1,subLayers:[{source:"WFS",url:["https://kart5.nois.no/trondheim_neste/wfs/default.asp?conname=Tiltak&"],name:"PblTiltak",version:"1.0.0",coordinate_system:"EPSG:32632",id:"8002",tiled:!1,style:"http://geoinnsyn.norconsultad.com/Services/ISY.GIS.IsyGeoinnsynConfig/api/v1/style?application=GeoInnsyn&name=pblTiltak_type"}],visibleOnLoad:!0}]});return{GetMapConfig:a}};var ISY=ISY||{};ISY.Utils=ISY.Utils||{},ISY.Utils.Guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}return{NewGuid:b}};